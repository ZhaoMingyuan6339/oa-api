var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{g as n,u as d,a as c,d as u,b as i}from"./index.240953cf.js";import{a as p,f as m,h as f}from"./index.e0281189.js";import{g as v,s as h}from"./dictFormat.fa6d45c4.js";import{u as g}from"./useDrawer.60140d94.js";import{_ as b}from"./index.d425032d.js";import{d as S,c as y,r as k,a as _,f as C,a6 as w,M as K,n as O,l as N,a3 as x,m as R,A as j,B as I,v as U,t as F,a4 as P,V as q,q as z,H as L,F as T,Z as A,U as D}from"./ant-design-vue.8fffeee5.js";const E=[{title:"角色名称",dataIndex:"roleName",key:"roleName",align:"center"},{title:"权限字符",dataIndex:"roleKey",key:"roleKey",align:"center"},{title:"显示顺序",dataIndex:"roleSort",key:"roleSort",align:"center"},{title:"状态",dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:"创建人",dataIndex:"createdBy",key:"createdBy",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var B=S({components:{FormSearch:b},setup(){const e=y((()=>p().loading)),b=k([]),S=k([]),N={roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"change"}],menuIds:[{required:!0,validator:()=>[...D.value.checked].length?Promise.resolve():Promise.reject("菜单权限为空"),trigger:"change"}]},x=_({pageNum:1,pageSize:10,roleName:"",status:""}),R=_([{type:"input",label:"角色名称",name:"roleName",value:"",placeholder:"请输入角色名称"},{type:"select",label:"状态",name:"status",value:void 0,placeholder:"请选择角色状态",normalizer:{value:"dictValue",label:"dictLabel"},options:b}]),j=k([]),I=k({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),U=_({selectedRowKeys:[]}),F=y((()=>U.selectedRowKeys.length>0)),P=e=>{n(e).then((e=>{console.log(e),j.value=e.data.rows,I.value.total=e.data.count,U.selectedRowKeys=[],j.value.forEach((e=>{"1"===e.status?e.checked=!0:e.checked=!1}))}))},q=k(),z=_({id:void 0,roleName:void 0,roleKey:void 0,roleSort:1,status:"1",menuIds:void 0,remark:void 0}),{open:L,drawerTitle:T}=g(),A=k([]),D=k({checked:[]}),B=()=>{m().then((e=>{A.value=f(e.data.rows,"id","parentId").tree}))},Q=_([{value:"1",label:"本部门及以下数据权限"},{value:"2",label:"本部门数据权限"},{value:"3",label:"仅本人数据权限"}]),V=k(),M=k(!1),H=_({id:void 0,roleName:"",roleKey:"",roleSort:void 0,status:void 0,menuIds:void 0,remark:void 0,dataScope:void 0});return C((async()=>{b.value=await v("sys_normal_disable"),S.value=await v("sys_normal_disable"),S.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),P(x),B()})),Z=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&s(e,l,a[l]);return e})({loading:e,queryParams:x,formFields:R,handleQuery:e=>{I.value.current=1,x.pageNum=I.value.current,x.roleName=e.roleName,x.status=e.status,P(x)},roleList:j,columns:E,pagination:I,handleTableChange:e=>{I.value=e,x.pageNum=I.value.current,x.pageSize=I.value.pageSize,P(x)},selectDictLabel:h,statusOptions:b},w(U)),a(Z,l({hasSelected:F,onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),U.selectedRowKeys=e},open:L,drawerTitle:T,formState:z,labelCol:{span:4},wrapperCol:{span:20},rules:N,formRef:q,handleClose:()=>{D.value.checked=[],z.id=void 0,q.value.resetFields(),console.log(q),L.value=!1},handleSubmit:()=>{q.value.validate().then((()=>{z.menuIds=[...D.value.checked],z.id?d(z).then((e=>{K.success(e.message),P(x),z.id=void 0,q.value.resetFields(),L.value=!1})):c(z).then((e=>{K.success(e.message),P(x),z.id=void 0,q.value.resetFields(),L.value=!1}))})).catch((e=>{console.log("error",e)}))},confirm:e=>{const a=e.id||U.selectedRowKeys;u(a).then((()=>{(a.length&&a.length===j.value.length||1===j.value.length)&&Math.ceil(I.value.total/x.pageSize)===x.pageNum&&x.pageNum>1&&x.pageNum--,P(x),K.success("删除成功")}))},cancel:e=>{console.log(e),K.success("取消删除")},handleAdd:()=>{L.value=!0,T.value="添加角色"},handleUpdate:e=>{i(e.id).then((e=>{L.value=!0,T.value="修改角色",O((()=>{Object.keys(z).forEach((a=>{z[a]=e.data[a]}));const a={checked:e.data.menus.map((e=>e.id)),halfChecked:[]};D.value=w(a)}))}))},menuOptions:A,checkedKeys:D,replaceFields:{children:"children",title:"title",key:"id"},disableOptions:S,dataScopeOptions:Q,formScopeRef:V,dataScopeOpen:M,formScopeState:H,scopeRules:{dataScope:[{required:!0,message:"权限范围不能为空",trigger:"blur"}]},handleScopeOpen:e=>{i(e.id).then((e=>{M.value=!0,O((()=>{Object.keys(H).forEach((a=>{H[a]=e.data[a]})),H.menuIds=e.data.menus.map((e=>e.id))}))}))},handleScopeClose:()=>{M.value=!1},handleScopeSubmit:()=>{V.value.validate().then((()=>{console.log("ok"),d(H).then((e=>{K.success(e.message),M.value=!1,P(x)}))})).catch((e=>{console.log("error",e)}))}}));var Z}});const Q={class:"p-4"},V={class:"mb-3"},M=D(" 新增 "),H=D(" 删除 "),Z={class:"text-[#1890ff]"},$=D(" 修改 "),G=D(" 数据权限 "),J=D(" 删除 "),W=D(" 确认 "),X=D("取消"),Y=D(" 确认 "),ee=D("取消");B.render=function(e,a,l,t,o,r){const s=N("form-search"),n=N("a-button"),d=N("a-col"),c=N("a-popconfirm"),u=N("a-row"),i=N("router-link"),p=N("a-table"),m=N("a-input"),f=N("a-form-item"),v=N("a-input-number"),h=N("a-radio-group"),g=N("a-tree"),b=N("a-textarea"),S=N("a-form"),y=N("a-drawer"),k=N("a-select-option"),_=N("a-select"),C=x("has-permi");return R(),j("div",Q,[I("div",V,[U(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),U(u,{gutter:10,class:"mb-2"},{default:F((()=>[P(U(d,null,{default:F((()=>[U(n,{color:"success",onClick:e.handleAdd},{default:F((()=>[M])),_:1},8,["onClick"])])),_:1},512),[[C,["system:role:add"]]]),P(U(d,null,{default:F((()=>[U(c,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:F((()=>[U(n,{disabled:!e.hasSelected,color:"error"},{default:F((()=>[H])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[C,["system:role:delete"]]])])),_:1}),U(p,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.roleList,pagination:e.pagination,onChange:e.handleTableChange},{roleKey:F((({record:e})=>[U(i,{to:"dictData/"+e.id},{default:F((()=>[I("span",Z,q(e.roleKey),1)])),_:2},1032,["to"])])),status:F((({record:a})=>[I("span",null,q(e.selectDictLabel(e.statusOptions,a.status)),1)])),action:F((({record:a})=>[I("span",null,[P(U(n,{type:"link",color:"success",class:"mr-3",onClick:l=>e.handleUpdate(a)},{default:F((()=>[$])),_:2},1032,["onClick"]),[[C,["system:role:update"]]]),P(U(n,{type:"link",color:"warning",class:"mr-3",onClick:l=>e.handleScopeOpen(a)},{default:F((()=>[G])),_:2},1032,["onClick"]),[[C,["system:role:update"]]]),U(c,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:l=>e.confirm(a),onCancel:e.cancel},{default:F((()=>[P(U(n,{type:"link",color:"error"},{default:F((()=>[J])),_:1},512),[[C,["system:role:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),U(y,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[6]||(a[6]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:F((()=>[e.open?(R(),z(S,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:F((()=>[U(u,null,{default:F((()=>[U(d,{span:24},{default:F((()=>[U(f,{label:"角色名称",name:"roleName"},{default:F((()=>[U(m,{value:e.formState.roleName,"onUpdate:value":a[0]||(a[0]=a=>e.formState.roleName=a),placeholder:"请输入角色名称"},null,8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"权限字符",name:"roleKey"},{default:F((()=>[U(m,{value:e.formState.roleKey,"onUpdate:value":a[1]||(a[1]=a=>e.formState.roleKey=a),placeholder:"请输入权限字符"},null,8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"显示排序",name:"roleSort"},{default:F((()=>[U(v,{class:"!w-[100%]",value:e.formState.roleSort,"onUpdate:value":a[2]||(a[2]=a=>e.formState.roleSort=a),placeholder:"请输入显示排序"},null,8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"状态",name:"status"},{default:F((()=>[U(h,{value:e.formState.status,"onUpdate:value":a[3]||(a[3]=a=>e.formState.status=a),options:e.disableOptions},null,8,["value","options"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"菜单权限",name:"menuIds"},{default:F((()=>[U(g,{blockNode:!0,checkable:"",checkStrictly:"","replace-fields":e.replaceFields,"tree-data":e.menuOptions,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[4]||(a[4]=a=>e.checkedKeys=a)},null,8,["replace-fields","tree-data","checkedKeys"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"备注",name:"remark"},{default:F((()=>[U(b,{rows:3,value:e.formState.remark,"onUpdate:value":a[5]||(a[5]=a=>e.formState.remark=a),placeholder:"请输入备注"},null,8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,null,{default:F((()=>[U(n,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:F((()=>[W])),_:1},8,["onClick"]),U(n,{onClick:e.handleClose},{default:F((()=>[X])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):L("",!0)])),_:1},8,["title","visible","onClose"]),U(y,{width:"540px",title:"分配数据权限",placement:"right",visible:e.dataScopeOpen,"onUpdate:visible":a[10]||(a[10]=a=>e.dataScopeOpen=a),maskClosable:!1,onClose:e.handleScopeClose},{default:F((()=>[e.dataScopeOpen?(R(),z(S,{key:0,ref:"formScopeRef",model:e.formScopeState,rules:e.scopeRules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:F((()=>[U(u,null,{default:F((()=>[U(d,{span:24},{default:F((()=>[U(f,{label:"角色名称",name:"roleName"},{default:F((()=>[U(m,{disabled:!0,value:e.formScopeState.roleName,"onUpdate:value":a[7]||(a[7]=a=>e.formScopeState.roleName=a),placeholder:"请输入角色名称"},null,8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"权限字符",name:"roleKey"},{default:F((()=>[U(m,{disabled:!0,value:e.formScopeState.roleKey,"onUpdate:value":a[8]||(a[8]=a=>e.formScopeState.roleKey=a),placeholder:"请输入权限字符"},null,8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,{label:"权限范围",name:"dataScope"},{default:F((()=>[U(_,{value:e.formScopeState.dataScope,"onUpdate:value":a[9]||(a[9]=a=>e.formScopeState.dataScope=a),placeholder:"请选择权限范围"},{default:F((()=>[(R(!0),j(T,null,A(e.dataScopeOptions,(e=>(R(),z(k,{key:e.value},{default:F((()=>[D(q(e.label),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1})])),_:1}),U(d,{span:24},{default:F((()=>[U(f,null,{default:F((()=>[U(n,{type:"primary",class:"mr-3",onClick:e.handleScopeSubmit},{default:F((()=>[Y])),_:1},8,["onClick"]),U(n,{onClick:e.handleScopeClose},{default:F((()=>[ee])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):L("",!0)])),_:1},8,["visible","onClose"])])};export{B as default};
