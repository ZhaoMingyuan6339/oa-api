var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;"undefined"!=typeof require&&require;import{H as r,a as i}from"./index.2c6e8c15.js";import{g as d,s as c}from"./dictFormat.b2531267.js";import{_ as u}from"./index.440d206b.js";import{_ as m}from"./index.14eac354.js";import{u as p}from"./useDrawer.6ddc8ed7.js";import{u as v}from"./useI18n.94ac6758.js";import{d as h,c as f,r as y,a as g,f as b,a6 as k,M as x,n as T,q as A,a3 as C,t as w,A as S,B as D,k as R,x as O,a4 as _,V as j,U as F,F as P,Z as N,v as E}from"./ant-design-vue.5cd75ca8.js";function L(e){return r("/admin/examineAndApprove/leave/"+e,"GET",{},!1)}function I(e){return r("/admin/examineAndApprove/leave/"+e.id,"PUT",e)}const{t:z}=v(),K=[{title:z("routes.leave.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:z("routes.leave.leaveType"),dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:z("routes.leave.duration"),dataIndex:"leaveDuration",key:"leaveDuration",align:"center"},{title:z("routes.leave.leaveReason"),dataIndex:"leaveReason",key:"leaveReason",align:"center"},{title:z("routes.leave.startTime"),dataIndex:"startTime",key:"startTime",align:"center"},{title:z("routes.leave.endTime"),dataIndex:"endTime",key:"endTime",align:"center"},{title:z("routes.leave.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:z("routes.leave.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:z("routes.leave.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:z("routes.leave.action"),key:"action",align:"center",slots:{customRender:"action"}}];var V=h({components:{FormSearch:u,BaseForm:m},setup(){const e=f((()=>i().loading)),u=y([]),m=y([]),v=y(),h=g({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),A=g([{type:"input",label:z("routes.leave.nickName"),name:"nickName",value:"",placeholder:z("routes.leave.nickNamePlaceholder")},{type:"select",label:z("routes.leave.status"),name:"status",value:void 0,placeholder:z("routes.leave.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:m},{type:"select",label:z("routes.leave.leaveType"),name:"type",value:void 0,placeholder:z("routes.leave.leaveTypePlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:u}]),C=y([]),w=y({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),S=y(),D=g({selectedRowKeys:[]}),R=f((()=>D.selectedRowKeys.length>0)),O=e=>{(function(e={}){return r("/admin/examineAndApprove/leave","GET",e)})(e).then((e=>{C.value=e.data.rows,w.value.total=e.data.count,D.selectedRowKeys=[]}))},{open:_,drawerTitle:j}=p(),F=g({id:void 0,leaveDate:"",type:void 0,leaveReason:void 0,time:[],startTime:"",endTime:""}),P=e=>{F.startTime=e[0],F.endTime=e[1]},N=g({time:[{required:!0,message:z("routes.leave.startTimePlaceholder")}],type:[{required:!0,message:z("routes.leave.endTimePlaceholder")}]}),E=g([{name:"time",label:z("routes.leave.selectTime"),type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:[z("routes.leave.startTime"),z("routes.leave.endTime")],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:P,change:P}},{name:"type",label:z("routes.leave.leaveType"),type:"select",value:void 0,span:24,placeholder:z("routes.leave.leaveTypePlaceholder"),options:u,serialize:{value:"dictValue",label:"dictLabel"}},{name:"leaveReason",label:z("routes.leave.leaveReason"),type:"textarea",value:void 0,span:24,placeholder:z("routes.leave.leaveReasonPlaceholder")}]);return b((async()=>{u.value=await d("sys_leave_type"),m.value=await d("sys_examineAndApprove_status"),u.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),m.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),O(h)})),V=((e,a)=>{for(var t in a||(a={}))n.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&s(e,t,a[t]);return e})({t:z,loading:e,queryParams:h,formFields:A,handleQuery:e=>{w.value.current=1,h.pageNum=w.value.current,h.nickName=e.nickName,h.type=e.type,h.status=e.status,O(h)},tableList:C,columns:K,pagination:w,hasSelected:R,handleTableChange:e=>{w.value=e,h.pageNum=w.value.current,h.pageSize=w.value.pageSize,O(h)},selectDictLabel:c,confirm:e=>{const a=e.id||D.selectedRowKeys;(function(e){return r("/admin/examineAndApprove/leave/"+e,"DELETE")})(a).then((()=>{(a.length&&a.length===C.value.length||1===C.value.length)&&Math.ceil(w.value.total/h.pageSize)===h.pageNum&&h.pageNum>1&&h.pageNum--,O(h),x.success(z("common.deleteSuccess"))}))},cancel:e=>{x.success(z("common.cancelDelete"))},onSelectChange:e=>{D.selectedRowKeys=e}},k(D)),a(V,t({handleExamineAndApprove:async({key:e})=>{S.value&&(await L(S.value.id).then((e=>{Object.keys(F).forEach((a=>{F[a]=e.data[a]}))})),F.status=e,I(F).then((e=>{x.success(e.message),O(h)})))},handleClickDropdown:e=>{S.value=e},BaseFormRef:v,open:_,drawerTitle:j,leaveTypeOptions:u,examineAndApproveStatusOptions:m,formState:F,rules:N,formDataObj:E,handleClose:()=>{F.id=void 0,v.value.resetFields(),_.value=!1},onOkTime:P,handleAdd:()=>{_.value=!0,j.value=z("common.add")},handleUpdate:e=>{L(e.id).then((e=>{_.value=!0,j.value=z("common.update"),T((()=>{Object.keys(F).forEach((a=>{F[a]=e.data[a],F.time=["",""],"startTime"===a&&T((()=>{F.time[0]=e.data[a]})),"endTime"===a&&T((()=>{F.time[1]=e.data[a]}))}))}))}))},handleSubmit:()=>{F.id?I(F).then((e=>{x.success(e.message),O(h),F.id=void 0,v.value.resetFields(),_.value=!1})):function(e={}){return r("/admin/examineAndApprove/leave","POST",e)}(F).then((e=>{x.success(e.message),O(h),F.id=void 0,v.value.resetFields(),_.value=!1}))}}));var V}});const Y={class:"p-4"},q={class:"mb-3"},M={class:"mr-3 text-[#faad14] cursor-pointer"};V.render=function(e,a,t,l,n,o){const s=A("form-search"),r=A("a-button"),i=A("a-col"),d=A("a-popconfirm"),c=A("a-row"),u=A("a-menu-item"),m=A("a-menu"),p=A("a-dropdown"),v=A("a-table"),h=A("BaseForm"),f=A("a-drawer"),y=C("has-permi");return w(),S("div",Y,[D("div",q,[R(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),R(c,{gutter:10,class:"mb-2"},{default:O((()=>[_(R(i,null,{default:O((()=>[R(r,{color:"success",onClick:e.handleAdd},{default:O((()=>[j(F(e.t("common.add")),1)])),_:1},8,["onClick"])])),_:1},512),[[y,["examineAndApprove:leave:add"]]]),_(R(i,null,{default:O((()=>[R(d,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:O((()=>[R(r,{disabled:!e.hasSelected,color:"error"},{default:O((()=>[j(F(e.t("common.delete")),1)])),_:1},8,["disabled"])])),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])])),_:1},512),[[y,["examineAndApprove:leave:delete"]]])])),_:1}),R(v,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:O((({record:e})=>[D("span",null,F(e.user.nickName),1)])),type:O((({record:a})=>[D("span",null,F(e.selectDictLabel(e.leaveTypeOptions,a.type)),1)])),status:O((({record:a})=>[D("span",null,F(e.selectDictLabel(e.examineAndApproveStatusOptions,a.status)),1)])),action:O((({record:a})=>[D("span",null,[_(D("span",null,[R(p,{trigger:["click"],onClick:t=>e.handleClickDropdown(a)},{overlay:O((()=>[R(m,{onClick:e.handleExamineAndApprove},{default:O((()=>[(w(!0),S(P,null,N(e.examineAndApproveStatusOptions,(e=>(w(),E(u,{disabled:"0"===e.dictValue,key:e.dictValue},{default:O((()=>[j(F(e.dictLabel),1)])),_:2},1032,["disabled"])))),128))])),_:1},8,["onClick"])])),default:O((()=>[D("span",M,F(e.t("routes.leave.approve")),1)])),_:2},1032,["onClick"])],512),[[y,["examineAndApprove:leave:update"]]]),_(R(r,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:O((()=>[j(F(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[y,["examineAndApprove:leave:update"]]]),R(d,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:O((()=>[_(R(r,{type:"link",color:"error"},{default:O((()=>[j(F(e.t("common.delete")),1)])),_:1},512),[[y,["examineAndApprove:leave:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),R(f,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:O((()=>[R(h,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{V as default};
