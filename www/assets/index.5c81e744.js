var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;import{g as r,s as d}from"./dictFormat.fa6d45c4.js";import{g as i}from"./index.996b9bbd.js";import{g as u,l as p,u as c,e as m,r as v}from"./index.4eed7447.js";import{g as h}from"./index.240953cf.js";import{u as f,a as b,h as g}from"./index.e0281189.js";import{u as y}from"./useDrawer.60140d94.js";import{_ as w}from"./index.a3f94848.js";import{_ as I}from"./index.b57edad9.js";import{_ as O}from"./index.d425032d.js";import{d as S,c as _,r as j,a as k,f as C,a6 as F,n as x,M as N,l as R,a3 as L,m as P,A as T,v as D,t as z,B,V as U,a4 as E,U as Q}from"./ant-design-vue.8fffeee5.js";const V=[{title:"昵称",dataIndex:"nickName",key:"nickName",align:"center"},{title:"部门",key:"department",align:"center",slots:{customRender:"department"}},{title:"岗位",key:"position",align:"center",slots:{customRender:"position"}},{title:"年假（天）",key:"annualLeave",dataIndex:"annualLeave",align:"center"},{title:"调休假（天）",dataIndex:"compensatoryLeave",key:"compensatoryLeave",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var q=S({components:{BaseForm:I,DeptSearch:w,FormSearch:O},setup(){const e=f(),w=_((()=>b().loading)),I=j(),O=j([]),S=j([]),R=j([]),L=j([]),P=j([]),T=j([]),D=j(),z=j([]),B=j([]),U=j(),E=k({nickName:"",deptId:0,pageNum:1,pageSize:10}),Q=k([{type:"input",label:"昵称",name:"nickName",value:void 0,placeholder:"请输入昵称"}]),q=e=>{A.value.current=1,E.pageNum=A.value.current,E.nickName=e.nickName,$(E)},K=j([]),A=j({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),M=j([]),$=a=>{p(a).then((e=>{K.value=e.data.rows,A.value.total=e.data.count})),i().then((a=>{const t=g(a.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,s=a.data.rows.filter((a=>a.deptId===e.userInfo.deptId));s[0].children=t,M.value=s,console.log(M)}))},G=j(),H=k([{name:"annualLeave",label:"年假",type:"input-number",value:void 0,span:24,placeholder:"请输入年假"},{name:"compensatoryLeave",label:"调休假",type:"input-number",span:24,value:void 0,placeholder:"请输入调休假"}]),J=k({id:void 0,deptId:void 0,nickName:void 0,userName:void 0,password:void 0,sex:"1",roleIds:[],mobile:void 0,status:"1",email:void 0,salary:void 0,position:"1",entryTime:"",birthday:"",education:void 0,annualLeave:void 0,compensatoryLeave:void 0,remark:void 0}),{open:W,drawerTitle:X}=y(),Y=j(!1),Z=j(),ee=j(!1),ae=k({id:0,newPassword:""}),te=()=>{i().then((e=>{z.value=e.data.rows,B.value=g(e.data.rows,"deptId","parentId","children",0).tree,D.value.expandedKeys.value=z.value.map((e=>e.id))})),$(E),h().then((e=>{O.value=e.data.rows}))};return C((async()=>{S.value=await r("sys_normal_disable"),R.value=await r("sys_user_position"),L.value=await r("sys_user_education"),P.value=await r("sys_normal_disable"),T.value=await r("sys_user_sex"),P.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),T.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),te()})),se=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&n(e,t,a[t]);if(s)for(var t of s(a))o.call(a,t)&&n(e,t,a[t]);return e})({loading:w,replaceFields:{children:"children",title:"deptName",key:"deptId"},deptSearchRef:D,originalTree:z,deptTreeOption:B,handleSelect:e=>{E.deptId=e[0],q(E)},queryRef:U,queryParams:E,formFields:Q,handleQuery:q,statusOptions:S,columns:V,userList:K,pagination:A,handleTableChange:e=>{A.value=e,E.pageNum=A.value.current,E.pageSize=A.value.pageSize,$(E)},selectDictLabel:d,getRoles:e=>e.roles.map((e=>e.roleName)).join(","),handleUpdate:e=>{u(e.id).then((e=>{W.value=!0,Y.value=!0,X.value="修改",x((()=>{Object.keys(J).forEach((a=>{J[a]=e.data[a]})),J.roleIds=e.data.roles.map((e=>e.id)),G.value.forest.selectedNodeIds.push(e.data.deptId),console.log(J)}))}))},BaseFormRef:I,formDataObj:H,treeRef:G,formRef:Z,rules:{},isUpdate:Y,open:W,drawerTitle:X,deptOptions:M,normalizer:e=>(e.children&&!e.children.length&&delete e.children,{id:e.deptId,label:e.deptName,children:e.children}),handleClose:()=>{J.id=void 0,I.value.resetFields(),W.value=!1},handleSubmit:()=>{J.id?c(J).then((e=>{N.success(e.message),$(E),J.id=void 0,I.value.resetFields(),W.value=!1})):m(J).then((e=>{N.success(e.message),$(E),J.id=void 0,I.value.resetFields(),W.value=!1}))},labelCol:{span:6},wrapperCol:{span:18},formState:J,roleOptions:O,positionOptions:R,educationOptions:L,disableOptions:P,sexOptions:T,visible:ee},F(ae)),a(se,t({handleResetPwd:()=>{ae.newPassword?v(ae.id,{newPassword:ae.newPassword}).then((e=>{N.success(e.message),ae.newPassword="",ee.value=!1})):N.error("新密码不能为空")},handleResetClose:()=>{ae.newPassword="",ee.value=!1}}));var se}});const K={class:"p-4"},A={class:"mb-3"},M=Q("导出"),$=Q(" 修改 ");q.render=function(e,a,t,s,l,o){const n=R("dept-search"),r=R("a-col"),d=R("form-search"),i=R("a-button"),u=R("a-row"),p=R("a-table"),c=R("BaseForm"),m=R("a-drawer"),v=L("has-permi");return P(),T("div",K,[D(u,{gutter:15},{default:z((()=>[D(r,{span:4},{default:z((()=>[D(n,{ref:"deptSearchRef",original:e.originalTree,data:e.deptTreeOption,baseFields:e.replaceFields,onSelect:e.handleSelect},null,8,["original","data","baseFields","onSelect"])])),_:1}),D(r,{span:20},{default:z((()=>[B("div",A,[D(d,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),D(u,{gutter:10,class:"mb-2"},{default:z((()=>[D(r,null,{default:z((()=>[D(i,{color:"normal"},{default:z((()=>[M])),_:1})])),_:1})])),_:1}),D(p,{loading:e.loading,rowKey:"id",columns:e.columns,"data-source":e.userList,pagination:e.pagination,onChange:e.handleTableChange},{department:z((({record:e})=>[B("span",null,U(e.department.deptName),1)])),roles:z((({record:a})=>[B("span",null,U(e.getRoles(a)),1)])),position:z((({record:a})=>[B("span",null,U(e.selectDictLabel(e.positionOptions,a.position)),1)])),action:z((({record:a})=>[B("span",null,[E(D(i,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:z((()=>[$])),_:2},1032,["onClick"]),[[v,["system:user:update"]]])])])),_:1},8,["loading","columns","data-source","pagination","onChange"])])),_:1})])),_:1}),D(m,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:z((()=>[D(c,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{q as default};
