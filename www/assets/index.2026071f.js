var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;"undefined"!=typeof require&&require;import{H as r,a as c,o as d}from"./index.2c6e8c15.js";import{g as i,s as u}from"./dictFormat.b2531267.js";import{_ as m}from"./index.440d206b.js";import{u as g}from"./useDrawer.6ddc8ed7.js";import{u as p}from"./useI18n.94ac6758.js";import{d as h,c as y,r as f,a as b,f as v,a6 as w,M as x,q as C,a3 as k,t as j,A as O,B as S,k as _,x as T,V as A,U as B,a4 as D,H as E}from"./ant-design-vue.5cd75ca8.js";const{t:R}=p(),F=[{title:R("routes.logs.createdBy"),dataIndex:"createdBy",key:"createdBy",align:"center"},{title:R("routes.logs.url"),dataIndex:"url",key:"url",align:"center"},{title:R("routes.logs.method"),dataIndex:"method",key:"method",align:"center"},{title:R("routes.logs.ip"),dataIndex:"ip",key:"ip",align:"center"},{title:R("routes.logs.status"),dataIndex:"status",key:"status",align:"center"},{title:R("routes.logs.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:R("routes.logs.action"),key:"action",align:"center",slots:{customRender:"action"}}];var I=h({components:{FormSearch:m},setup(){const e=c(),m=y((()=>e.loading)),p=f([]),h=b({pageNum:1,pageSize:10,createdBy:"",method:""}),C=b([{type:"input",label:R("routes.logs.createdBy"),name:"createdBy",value:"",placeholder:R("routes.logs.createdByPlaceholder")},{type:"select",label:R("routes.logs.method"),name:"method",value:void 0,placeholder:R("routes.logs.methodPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:p}]),k=f([]),j=f({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),O=b({selectedRowKeys:[]}),S=y((()=>O.selectedRowKeys.length>0)),_=e=>{(function(e={}){return r("/admin/system/logs","GET",e)})(e).then((e=>{k.value=e.data.rows,j.value.total=e.data.count,O.selectedRowKeys=[]}))},{open:T,drawerTitle:A}=g(),B=f();return v((async()=>{p.value=await i("sys_method_type"),_(h)})),D=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&n(e,a,t[a]);if(l)for(var a of l(t))s.call(t,a)&&n(e,a,t[a]);return e})({t:R,loading:m,queryParams:h,formFields:C,handleQuery:e=>{j.value.current=1,h.pageNum=j.value.current,h.createdBy=e.createdBy,h.method=e.method,_(h)},logsList:k,columns:F,pagination:j,hasSelected:S,methodOptions:p,handleExportFile:()=>{d("/admin/system/logs/export",{},`${R("routes.logs.logs")}.xlsx`)},clearAll:()=>{r("/admin/system/logs/deleteAllLogs","DELETE").then((()=>{_(h),x.success(R("routes.logs.clearAllSuccess"))}))},handleTableChange:e=>{j.value=e,h.pageNum=j.value.current,h.pageSize=j.value.pageSize,_(h)},selectDictLabel:u,confirm:e=>{const t=e.id||O.selectedRowKeys;(function(e){return r("/admin/system/logs/"+e,"DELETE")})(t).then((()=>{(t.length&&t.length===k.value.length||1===k.value.length)&&Math.ceil(j.value.total/h.pageSize)===h.pageNum&&h.pageNum>1&&h.pageNum--,_(h),x.success(R("common.deleteSuccess"))}))},cancel:e=>{x.success(R("common.cancelDelete"))},onSelectChange:e=>{O.selectedRowKeys=e}},w(O)),t(D,a({open:T,drawerTitle:A,detailObj:B,handleClose:()=>{T.value=!1},showDetail:e=>{T.value=!0,A.value=R("common.detail"),B.value=e}}));var D}});const K={class:"p-4"},L={class:"mb-3"},P={key:0},z={class:"mb-2"},N={class:"mb-2"},q={class:"mb-2"},Q={class:"mb-2"},H={class:"mb-2"},M={class:"mb-2"},U={class:"mb-2"};I.render=function(e,t,a,l,o,s){const n=C("form-search"),r=C("a-button"),c=C("a-col"),d=C("a-popconfirm"),i=C("a-row"),u=C("a-table"),m=C("a-drawer"),g=k("has-permi");return j(),O("div",K,[S("div",L,[_(n,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),_(i,{gutter:10,class:"mb-2"},{default:T((()=>[_(c,null,{default:T((()=>[_(r,{color:"normal",onClick:e.handleExportFile},{default:T((()=>[A(B(e.t("common.export")),1)])),_:1},8,["onClick"])])),_:1}),D(_(c,null,{default:T((()=>[_(r,{color:"warning",onClick:e.clearAll},{default:T((()=>[A(B(e.t("common.clearAll")),1)])),_:1},8,["onClick"])])),_:1},512),[[g,["system:logs:deleteAllLogs"]]]),D(_(c,null,{default:T((()=>[_(d,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:T((()=>[_(r,{disabled:!e.hasSelected,color:"error"},{default:T((()=>[A(B(e.t("common.delete")),1)])),_:1},8,["disabled"])])),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])])),_:1},512),[[g,["system:logs:delete"]]])])),_:1}),_(u,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.logsList,pagination:e.pagination,onChange:e.handleTableChange},{action:T((({record:t})=>[S("span",null,[_(r,{type:"link",color:"success",class:"mr-3",onClick:a=>e.showDetail(t)},{default:T((()=>[A(B(e.t("common.detail")),1)])),_:2},1032,["onClick"]),_(d,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:a=>e.confirm(t),onCancel:e.cancel},{default:T((()=>[D(_(r,{type:"link",color:"error"},{default:T((()=>[A(B(e.t("common.delete")),1)])),_:1},512),[[g,["system:logs:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),_(m,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":t[0]||(t[0]=t=>e.open=t),maskClosable:!1,onClose:e.handleClose},{default:T((()=>[e.detailObj?(j(),O("div",P,[S("p",z,B(e.t("routes.logs.createdBy"))+": "+B(e.detailObj.createdBy),1),S("p",N,B(e.t("routes.logs.url"))+": "+B(e.detailObj.url),1),S("p",q,B(e.t("routes.logs.ip"))+": "+B(e.detailObj.ip),1),S("p",Q,B(e.t("routes.logs.method"))+": "+B(e.detailObj.method),1),S("p",H,B(e.t("routes.logs.status"))+": "+B(e.detailObj.status),1),S("p",M,B(e.t("routes.logs.data"))+": "+B(e.detailObj.data),1),S("p",U,B(e.t("routes.logs.createdAt"))+": "+B(e.detailObj.createdAt),1)])):E("",!0)])),_:1},8,["title","visible","onClose"])])};export{I as default};
