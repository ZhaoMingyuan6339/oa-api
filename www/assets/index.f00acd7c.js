var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;"undefined"!=typeof require&&require;import{H as s,a as c}from"./index.2c6e8c15.js";import{g as r,s as d}from"./dictFormat.b2531267.js";import{_ as u}from"./index.14eac354.js";import{_ as m}from"./index.440d206b.js";import{u as p}from"./useDrawer.6ddc8ed7.js";import{u as v}from"./useI18n.94ac6758.js";import{d as h,c as y,r as f,a as g,f as b,a6 as k,M as x,n as T,q as A,a3 as C,t as w,A as S,B as D,k as R,x as O,a4 as _,V as j,U as F,F as P,Z as N,v as E}from"./ant-design-vue.5cd75ca8.js";function L(e){return s("/admin/examineAndApprove/evection/"+e,"GET",{},!1)}function I(e){return s("/admin/examineAndApprove/evection/"+e.id,"PUT",e)}const{t:z}=v(),K=[{title:z("routes.evection.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:z("routes.evection.evectionType"),dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:z("routes.evection.evectionDuration"),dataIndex:"evectionDuration",key:"evectionDuration",align:"center"},{title:z("routes.evection.evectionReason"),dataIndex:"evectionReason",key:"evectionReason",align:"center"},{title:z("routes.evection.startTime"),dataIndex:"startTime",key:"startTime",align:"center"},{title:z("routes.evection.endTime"),dataIndex:"endTime",key:"endTime",align:"center"},{title:z("routes.evection.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:z("routes.evection.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:z("routes.evection.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:z("routes.evection.action"),key:"action",align:"center",slots:{customRender:"action"}}];var V=h({components:{FormSearch:m,BaseForm:u},setup(){const e=y((()=>c().loading)),u=f([]),m=f([]),v=f(),h=g({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),A=g([{type:"input",label:z("routes.evection.nickName"),name:"nickName",value:"",placeholder:z("routes.evection.nickNamePlaceholder")},{type:"select",label:z("routes.evection.status"),name:"status",value:void 0,placeholder:z("routes.evection.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:m},{type:"select",label:z("routes.evection.evectionType"),name:"type",value:void 0,placeholder:z("routes.evection.evectionTypePlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:u}]),C=f([]),w=f({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),S=f(),D=g({selectedRowKeys:[]}),R=y((()=>D.selectedRowKeys.length>0)),O=e=>{(function(e={}){return s("/admin/examineAndApprove/evection","GET",e)})(e).then((e=>{C.value=e.data.rows,w.value.total=e.data.count,D.selectedRowKeys=[]}))},{open:_,drawerTitle:j}=p(),F=g({id:void 0,evectionDate:"",type:void 0,evectionReason:void 0,time:[],startTime:"",endTime:""}),P=g({time:[{required:!0,message:z("routes.evection.evectionDurationPlaceholder")}],type:[{required:!0,message:z("routes.evection.evectionTypePlaceholder")}]}),N=e=>{F.startTime=e[0],F.endTime=e[1]},E=g([{name:"time",label:z("routes.evection.selectTime"),type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:[z("routes.evection.startTime"),z("routes.evection.endTime")],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:N,change:N}},{name:"type",label:z("routes.evection.evectionType"),type:"select",value:void 0,span:24,placeholder:z("routes.evection.evectionTypePlaceholder"),options:u,serialize:{value:"dictValue",label:"dictLabel"}},{name:"evectionReason",label:z("routes.evection.evectionReason"),type:"textarea",value:void 0,span:24,placeholder:z("routes.evection.evectionReasonPlaceholder")}]);return b((async()=>{u.value=await r("sys_evection_type"),m.value=await r("sys_examineAndApprove_status"),u.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),m.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),O(h)})),V=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&i(e,a,t[a]);if(n)for(var a of n(t))l.call(t,a)&&i(e,a,t[a]);return e})({t:z,loading:e,queryParams:h,formFields:A,handleQuery:e=>{w.value.current=1,h.pageNum=w.value.current,h.nickName=e.nickName,h.type=e.type,h.status=e.status,O(h)},tableList:C,columns:K,pagination:w,hasSelected:R,handleTableChange:e=>{w.value=e,h.pageNum=w.value.current,h.pageSize=w.value.pageSize,O(h)},selectDictLabel:d,confirm:e=>{const t=e.id||D.selectedRowKeys;(function(e){return s("/admin/examineAndApprove/evection/"+e,"DELETE")})(t).then((()=>{(t.length&&t.length===C.value.length||1===C.value.length)&&Math.ceil(w.value.total/h.pageSize)===h.pageNum&&h.pageNum>1&&h.pageNum--,O(h),x.success(z("common.deleteSuccess"))}))},cancel:e=>{x.success(z("common.cancelDelete"))},onSelectChange:e=>{D.selectedRowKeys=e}},k(D)),t(V,a({handleExamineAndApprove:async({key:e})=>{S.value&&(await L(S.value.id).then((e=>{Object.keys(F).forEach((t=>{F[t]=e.data[t]}))})),F.status=e,I(F).then((e=>{x.success(e.message),O(h)})))},handleClickDropdown:e=>{S.value=e},BaseFormRef:v,open:_,drawerTitle:j,evectionTypeOptions:u,examineAndApproveStatusOptions:m,formState:F,formDataObj:E,rules:P,handleClose:()=>{F.id=void 0,_.value=!1,v.value.resetFields()},onOkTime:N,handleAdd:()=>{_.value=!0,j.value=z("common.add")},handleUpdate:e=>{L(e.id).then((e=>{_.value=!0,j.value=z("common.update"),T((()=>{Object.keys(F).forEach((t=>{F[t]=e.data[t],F.time=["",""],"startTime"===t&&T((()=>{F.time[0]=e.data[t]})),"endTime"===t&&T((()=>{F.time[1]=e.data[t]}))}))}))}))},handleSubmit:()=>{F.id?I(F).then((e=>{x.success(e.message),O(h),F.id=void 0,v.value.resetFields(),_.value=!1})):function(e={}){return s("/admin/examineAndApprove/evection","POST",e)}(F).then((e=>{x.success(e.message),O(h),F.id=void 0,v.value.resetFields(),_.value=!1}))}}));var V}});const Y={class:"p-4"},q={class:"mb-3"},M={class:"mr-3 text-[#faad14] cursor-pointer"};V.render=function(e,t,a,n,o,l){const i=A("form-search"),s=A("a-button"),c=A("a-col"),r=A("a-popconfirm"),d=A("a-row"),u=A("a-menu-item"),m=A("a-menu"),p=A("a-dropdown"),v=A("a-table"),h=A("BaseForm"),y=A("a-drawer"),f=C("has-permi");return w(),S("div",Y,[D("div",q,[R(i,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),R(d,{gutter:10,class:"mb-2"},{default:O((()=>[_(R(c,null,{default:O((()=>[R(s,{color:"success",onClick:e.handleAdd},{default:O((()=>[j(F(e.t("common.add")),1)])),_:1},8,["onClick"])])),_:1},512),[[f,["examineAndApprove:evection:add"]]]),_(R(c,null,{default:O((()=>[R(r,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:O((()=>[R(s,{disabled:!e.hasSelected,color:"error"},{default:O((()=>[j(F(e.t("common.delete")),1)])),_:1},8,["disabled"])])),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])])),_:1},512),[[f,["examineAndApprove:evection:delete"]]])])),_:1}),R(v,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:O((({record:e})=>[D("span",null,F(e.user.nickName),1)])),type:O((({record:t})=>[D("span",null,F(e.selectDictLabel(e.evectionTypeOptions,t.type)),1)])),status:O((({record:t})=>[D("span",null,F(e.selectDictLabel(e.examineAndApproveStatusOptions,t.status)),1)])),action:O((({record:t})=>[D("span",null,[_(D("span",null,[R(p,{trigger:["click"],onClick:a=>e.handleClickDropdown(t)},{overlay:O((()=>[R(m,{onClick:e.handleExamineAndApprove},{default:O((()=>[(w(!0),S(P,null,N(e.examineAndApproveStatusOptions,(e=>(w(),E(u,{disabled:"0"===e.dictValue,key:e.dictValue},{default:O((()=>[j(F(e.dictLabel),1)])),_:2},1032,["disabled"])))),128))])),_:1},8,["onClick"])])),default:O((()=>[D("span",M,F(e.t("routes.evection.approve")),1)])),_:2},1032,["onClick"])],512),[[f,["examineAndApprove:evection:update"]]]),_(R(s,{type:"link",color:"success",class:"mr-3",onClick:a=>e.handleUpdate(t)},{default:O((()=>[j(F(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[f,["examineAndApprove:evection:update"]]]),R(r,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:a=>e.confirm(t),onCancel:e.cancel},{default:O((()=>[_(R(s,{type:"link",color:"error"},{default:O((()=>[j(F(e.t("common.delete")),1)])),_:1},512),[[f,["examineAndApprove:evection:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),R(y,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":t[0]||(t[0]=t=>e.open=t),maskClosable:!1,onClose:e.handleClose},{default:O((()=>[R(h,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{V as default};
