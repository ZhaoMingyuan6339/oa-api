import{u as e,a as t,d as a,g as d,b as l}from"./index.a28e8132.js";import{a as o,u as r,h as s}from"./index.2c6e8c15.js";import{T as n,f as u}from"./validate.05ef885d.js";import{u as c}from"./useDrawer.6ddc8ed7.js";import{g as p}from"./dictFormat.b2531267.js";import{u as i}from"./useI18n.94ac6758.js";import{d as m,c as f,r as v,a as h,f as I,M as b,n as g,q as k,a3 as C,t as N,A as _,k as w,x as y,a4 as x,V as S,U as T,B as j,v as D,a5 as A,H as U}from"./ant-design-vue.5cd75ca8.js";const{t:B}=i(),R=[{title:B("routes.dept.deptName"),dataIndex:"deptName",key:"deptName"},{title:B("routes.dept.orderNum"),dataIndex:"orderNum",key:"orderNum",align:"center"},{title:B("routes.dept.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:B("routes.dept.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:B("routes.dept.action"),key:"action",align:"center",slots:{customRender:"action"}}];var E=m({components:{Treeselect:n},setup(){const n=f((()=>o().loading)),i=v([]),m=r(),k=v(),C={parentId:[{required:!0,validator:u.number,message:B("routes.dept.superiorDepartmentCannotBeBlank"),trigger:"change"}],deptName:[{required:!0,message:B("routes.dept.deptNameCannotBeBlank"),trigger:"blur"}],orderNum:[{required:!0,validator:u.number,message:B("routes.dept.orderNumCannotBeBlank"),trigger:"blur"}]},N=v(),_=v([]),w=v([]),y=()=>{d().then((e=>{const t=s(e.data.rows,"deptId","parentId","children",m.userInfo.deptId).tree,a=e.data.rows.filter((e=>e.deptId===m.userInfo.deptId));a[0].children=t,w.value=a,_.value=a}))},x=h({deptId:void 0,parentId:void 0,deptName:void 0,orderNum:"1",status:"1"}),{open:S,drawerTitle:T}=c();return I((async()=>{i.value=await p("sys_normal_disable"),i.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),y()})),{t:B,loading:n,deptList:w,confirm:e=>{a(e.deptId).then((()=>{y(),b.success(B("common.deleteSuccess"))}))},cancel:e=>{b.success(B("common.cancelDelete"))},columns:R,handleAdd:e=>{d().then((t=>{t.data.rows.forEach((e=>{e.isDisabled=!1}));const a=s(t.data.rows,"deptId","parentId","children",m.userInfo.deptId).tree,d=t.data.rows.filter((e=>e.deptId===m.userInfo.deptId));d[0].children=a,w.value=d,_.value=d,S.value=!0,T.value=B("common.add"),null!=e&&e.deptId&&g((()=>{x.parentId=e.deptId,k.value&&k.value.forest.selectedNodeIds.push(e.deptId)}))}))},handleUpdate:e=>{d().then((t=>{t.data.rows.forEach((t=>{t.deptId===e.deptId?t.isDisabled=!0:t.isDisabled=!1}));const a=s(t.data.rows,"deptId","parentId","children",m.userInfo.deptId).tree,d=t.data.rows.filter((e=>e.deptId===m.userInfo.deptId));d[0].children=a,w.value=d,_.value=d,l(e.deptId).then((e=>{S.value=!0,T.value=B("common.update"),g((()=>{Object.keys(x).forEach((t=>{x[t]=e.data[t]})),k.value.forest.selectedNodeIds.push(e.data.parentId)}))}))}))},open:S,drawerTitle:T,handleClose:()=>{x.deptId=void 0,N.value.resetFields(),S.value=!1},handleSubmit:()=>{N.value.validate().then((()=>{x.deptId?e(x).then((e=>{b.success(e.message),y(),x.deptId=void 0,N.value.resetFields(),S.value=!1})):t(x).then((e=>{b.success(e.message),y(),x.deptId=void 0,N.value.resetFields(),S.value=!1}))})).catch((e=>{}))},formState:x,labelCol:{span:6},wrapperCol:{span:18},normalizer:e=>(e.children&&!e.children.length&&delete e.children,{id:e.deptId,label:e.deptName,children:e.children}),deptOptions:_,rules:C,formRef:N,treeRef:k,handleTreeSelect:e=>{x.parentId=e.deptId},disableOptions:i}}});const O={class:"p-4"},q={class:"flex justify-center"},z={class:"flex justify-center"};E.render=function(e,t,a,d,l,o){const r=k("a-button"),s=k("a-col"),n=k("a-row"),u=k("svg-icon"),c=k("a-popconfirm"),p=k("a-table"),i=k("treeselect"),m=k("a-form-item"),f=k("a-input"),v=k("a-input-number"),h=k("a-radio-group"),I=k("a-form"),b=k("a-drawer"),g=C("has-permi");return N(),_("div",O,[w(n,{gutter:10,class:"mb-2"},{default:y((()=>[x(w(s,null,{default:y((()=>[w(r,{color:"success",onClick:e.handleAdd},{default:y((()=>[S(T(e.t("common.add")),1)])),_:1},8,["onClick"])])),_:1},512),[[g,["system:department:add"]]])])),_:1}),w(p,{loading:e.loading,rowKey:"deptId",columns:e.columns,"data-source":e.deptList,defaultExpandAllRows:!0,pagination:!1},{icon:y((({record:e})=>[j("div",q,[w(u,{name:e.icon},null,8,["name"])])])),status:y((({record:t})=>[j("div",z,[j("span",null,T("1"===t.status?e.t("common.normal"):e.t("common.deactivate")),1)])])),action:y((({record:t})=>[j("span",null,[x(w(r,{type:"link",color:"success",class:"mr-3",onClick:a=>e.handleAdd(t)},{default:y((()=>[S(T(e.t("common.add")),1)])),_:2},1032,["onClick"]),[[g,["system:department:add"]]]),x(w(r,{type:"link",color:"success",class:"mr-3",onClick:a=>e.handleUpdate(t)},{default:y((()=>[S(T(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[g,["system:department:update"]]]),w(c,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:a=>e.confirm(t),onCancel:e.cancel},{default:y((()=>[x(w(r,{type:"link",color:"error"},{default:y((()=>[S(T(e.t("common.delete")),1)])),_:1},512),[[g,["system:department:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","columns","data-source"]),w(b,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":t[4]||(t[4]=t=>e.open=t),maskClosable:!1,onClose:e.handleClose},{default:y((()=>[e.open?(N(),D(I,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:y((()=>[w(n,null,{default:y((()=>[x(w(s,{span:12},{default:y((()=>[w(m,{label:e.t("routes.dept.superiorDepartment"),name:"parentId"},{default:y((()=>[w(i,{ref:"treeRef",class:"!mt-[3px]",value:e.formState.parentId,"onUpdate:value":t[0]||(t[0]=t=>e.formState.parentId=t),normalizer:e.normalizer,placeholder:e.t("routes.dept.superiorDepartmentPlaceholder"),options:e.deptOptions,onSelect:e.handleTreeSelect},null,8,["value","normalizer","placeholder","options","onSelect"])])),_:1},8,["label"])])),_:1},512),[[A,0!==e.formState.parentId]]),w(s,{span:12},{default:y((()=>[w(m,{label:e.t("routes.dept.deptName"),name:"deptName"},{default:y((()=>[w(f,{value:e.formState.deptName,"onUpdate:value":t[1]||(t[1]=t=>e.formState.deptName=t),placeholder:e.t("routes.dept.deptNamePlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),w(s,{span:12},{default:y((()=>[w(m,{label:e.t("routes.dept.orderNum"),name:"orderNum"},{default:y((()=>[w(v,{class:"!w-[100%]",value:e.formState.orderNum,"onUpdate:value":t[2]||(t[2]=t=>e.formState.orderNum=t),placeholder:e.t("routes.dept.orderNumPlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),w(s,{span:12},{default:y((()=>[w(m,{label:e.t("routes.dept.status"),name:"status"},{default:y((()=>[w(h,{value:e.formState.status,"onUpdate:value":t[3]||(t[3]=t=>e.formState.status=t),options:e.disableOptions},null,8,["value","options"])])),_:1},8,["label"])])),_:1}),w(s,{span:24},{default:y((()=>[w(m,null,{default:y((()=>[w(r,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:y((()=>[S(T(e.t("common.okText")),1)])),_:1},8,["onClick"]),w(r,{onClick:e.handleClose},{default:y((()=>[S(T(e.t("common.cancelText")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):U("",!0)])),_:1},8,["title","visible","onClose"])])};export{E as default};
