var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{H as r,a as i}from"./index.e0281189.js";import{g as d,s as c}from"./dictFormat.fa6d45c4.js";import{_ as u}from"./index.d425032d.js";import{_ as m}from"./index.b57edad9.js";import{u as p}from"./useDrawer.60140d94.js";import{d as v,c as f,r as g,a as h,f as y,a6 as b,M as k,n as A,l as x,a3 as C,m as w,A as S,B as T,v as _,t as O,a4 as R,V as D,F as j,Z as F,q as E,U as L}from"./ant-design-vue.8fffeee5.js";function N(e){return r("/admin/examineAndApprove/leave/"+e,"GET",{},!1)}function z(e){return r("/admin/examineAndApprove/leave/"+e.id,"PUT",e)}const I=[{title:"姓名",key:"user",align:"center",slots:{customRender:"user"}},{title:"请假类型",dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:"请假时长（小时）",dataIndex:"leaveDuration",key:"leaveDuration",align:"center"},{title:"请假原因",dataIndex:"leaveReason",key:"leaveReason",align:"center"},{title:"开始时间",dataIndex:"startTime",key:"startTime",align:"center"},{title:"结束时间",dataIndex:"endTime",key:"endTime",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"审批状态",dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:"审批备注",dataIndex:"remark",key:"remark",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var K=v({components:{FormSearch:u,BaseForm:m},setup(){const e=f((()=>i().loading)),u=g([]),m=g([]),v=g(),x=h({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),C=h([{type:"input",label:"姓名",name:"nickName",value:"",placeholder:"请输入姓名"},{type:"select",label:"审批状态",name:"status",value:void 0,placeholder:"请选择审批状态",normalizer:{value:"dictValue",label:"dictLabel"},options:m},{type:"select",label:"请假类型",name:"type",value:void 0,placeholder:"请选择请假类型",normalizer:{value:"dictValue",label:"dictLabel"},options:u}]),w=g([]),S=g({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),T=g(),_=h({selectedRowKeys:[]}),O=f((()=>_.selectedRowKeys.length>0)),R=e=>{(function(e={}){return r("/admin/examineAndApprove/leave","GET",e)})(e).then((e=>{console.log(e),w.value=e.data.rows,S.value.total=e.data.count,_.selectedRowKeys=[]}))},{open:D,drawerTitle:j}=p(),F=h({id:void 0,leaveDate:"",type:void 0,leaveReason:void 0,time:[],startTime:"",endTime:""}),E=e=>{F.startTime=e[0],F.endTime=e[1]},L=h({time:[{required:!0,message:"请选择出差时间"}],type:[{required:!0,message:"请选择出差类型"}]}),K=h([{name:"time",label:"选择时间",type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:["开始时间","结束时间"],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:E,change:E}},{name:"type",label:"请假类型",type:"select",value:void 0,span:24,placeholder:"请选择请假类型",options:u,serialize:{value:"dictValue",label:"dictLabel"}},{name:"leaveReason",label:"请假原因",type:"textarea",value:void 0,span:24,placeholder:"请输入请假原因"}]);return y((async()=>{u.value=await d("sys_leave_type"),m.value=await d("sys_examineAndApprove_status"),u.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),m.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),R(x)})),P=((e,a)=>{for(var t in a||(a={}))n.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&s(e,t,a[t]);return e})({loading:e,queryParams:x,formFields:C,handleQuery:e=>{S.value.current=1,x.pageNum=S.value.current,x.nickName=e.nickName,x.type=e.type,x.status=e.status,R(x)},tableList:w,columns:I,pagination:S,hasSelected:O,handleTableChange:e=>{S.value=e,x.pageNum=S.value.current,x.pageSize=S.value.pageSize,R(x)},selectDictLabel:c,confirm:e=>{const a=e.id||_.selectedRowKeys;(function(e){return r("/admin/examineAndApprove/leave/"+e,"DELETE")})(a).then((()=>{(a.length&&a.length===w.value.length||1===w.value.length)&&Math.ceil(S.value.total/x.pageSize)===x.pageNum&&x.pageNum>1&&x.pageNum--,R(x),k.success("删除成功")}))},cancel:e=>{console.log(e),k.success("取消删除")},onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),_.selectedRowKeys=e}},b(_)),a(P,t({handleExamineAndApprove:async({key:e})=>{console.log(e,T),T.value&&(await N(T.value.id).then((e=>{Object.keys(F).forEach((a=>{F[a]=e.data[a]}))})),F.status=e,z(F).then((e=>{k.success(e.message),R(x)})))},handleClickDropdown:e=>{T.value=e},BaseFormRef:v,open:D,drawerTitle:j,leaveTypeOptions:u,examineAndApproveStatusOptions:m,formState:F,rules:L,formDataObj:K,handleClose:()=>{F.id=void 0,v.value.resetFields(),D.value=!1},onOkTime:E,handleAdd:()=>{D.value=!0,j.value="添加"},handleUpdate:e=>{N(e.id).then((e=>{D.value=!0,j.value="修改",A((()=>{Object.keys(F).forEach((a=>{F[a]=e.data[a],F.time=["",""],"startTime"===a&&A((()=>{F.time[0]=e.data[a]})),"endTime"===a&&A((()=>{F.time[1]=e.data[a]}))}))}))}))},handleSubmit:()=>{console.log(F),F.id?z(F).then((e=>{k.success(e.message),R(x),F.id=void 0,v.value.resetFields(),D.value=!1})):function(e={}){return r("/admin/examineAndApprove/leave","POST",e)}(F).then((e=>{k.success(e.message),R(x),F.id=void 0,v.value.resetFields(),D.value=!1}))}}));var P}});const P={class:"p-4"},V={class:"mb-3"},Y=L(" 新增 "),M=L(" 删除 "),B=L("导出"),H=T("span",{class:"mr-3 text-[#faad14] cursor-pointer"}," 审批 ",-1),U=L(" 修改 "),q=L(" 删除 ");K.render=function(e,a,t,l,n,o){const s=x("form-search"),r=x("a-button"),i=x("a-col"),d=x("a-popconfirm"),c=x("a-row"),u=x("a-menu-item"),m=x("a-menu"),p=x("a-dropdown"),v=x("a-table"),f=x("BaseForm"),g=x("a-drawer"),h=C("has-permi");return w(),S("div",P,[T("div",V,[_(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),_(c,{gutter:10,class:"mb-2"},{default:O((()=>[R(_(i,null,{default:O((()=>[_(r,{color:"success",onClick:e.handleAdd},{default:O((()=>[Y])),_:1},8,["onClick"])])),_:1},512),[[h,["examineAndApprove:leave:add"]]]),R(_(i,null,{default:O((()=>[_(d,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:O((()=>[_(r,{disabled:!e.hasSelected,color:"error"},{default:O((()=>[M])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[h,["examineAndApprove:leave:delete"]]]),_(i,null,{default:O((()=>[_(r,{color:"normal"},{default:O((()=>[B])),_:1})])),_:1})])),_:1}),_(v,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:O((({record:e})=>[T("span",null,D(e.user.nickName),1)])),type:O((({record:a})=>[T("span",null,D(e.selectDictLabel(e.leaveTypeOptions,a.type)),1)])),status:O((({record:a})=>[T("span",null,D(e.selectDictLabel(e.examineAndApproveStatusOptions,a.status)),1)])),action:O((({record:a})=>[T("span",null,[_(p,{trigger:["click"],onClick:t=>e.handleClickDropdown(a)},{overlay:O((()=>[_(m,{onClick:e.handleExamineAndApprove},{default:O((()=>[(w(!0),S(j,null,F(e.examineAndApproveStatusOptions,(e=>(w(),E(u,{disabled:"0"===e.dictValue,key:e.dictValue},{default:O((()=>[L(D(e.dictLabel),1)])),_:2},1032,["disabled"])))),128))])),_:1},8,["onClick"])])),default:O((()=>[H])),_:2},1032,["onClick"]),R(_(r,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:O((()=>[U])),_:2},1032,["onClick"]),[[h,["examineAndApprove:leave:update"]]]),_(d,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:O((()=>[R(_(r,{type:"link",color:"error"},{default:O((()=>[q])),_:1},512),[[h,["examineAndApprove:leave:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),_(g,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:O((()=>[_(f,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{K as default};
