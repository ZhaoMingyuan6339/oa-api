var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,t,n)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n;"undefined"!=typeof require&&require;import{g as s,a as d,d as u,u as c,b as i}from"./index.04df7211.js";import{a as p}from"./index.2c6e8c15.js";import{_ as y}from"./index.14eac354.js";import{d as m,c as h,r as v,a as b,f,a6 as g,ac as A,n as k,M as C,q as x,a3 as S,t as L,A as M,B as P,k as w,x as F,V as j,U as R,a4 as H}from"./ant-design-vue.5cd75ca8.js";import{_ as N}from"./index.440d206b.js";import{u as _}from"./useDrawer.6ddc8ed7.js";import{u as O}from"./useI18n.94ac6758.js";const{t:I}=O(),T=[{title:I("routes.salary.yearAndMounth"),key:"yearAndMounth",align:"center",slots:{customRender:"yearAndMounth"}},{title:I("routes.salary.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:I("routes.salary.currentSalary"),key:"currentSalary",align:"center",slots:{customRender:"currentSalary"}},{title:I("routes.salary.expectedAttendanceHours"),dataIndex:"expectedAttendanceHours",key:"expectedAttendanceHours",align:"center"},{title:I("routes.salary.attendanceHours"),dataIndex:"attendanceHours",key:"attendanceHours",align:"center"},{title:I("routes.salary.paidLeave"),dataIndex:"paidLeave",key:"paidLeave",align:"center"},{title:I("routes.salary.unpaidLeave"),dataIndex:"unpaidLeave",key:"unpaidLeave",align:"center"},{title:I("routes.salary.beLateAndLeaveEarly"),dataIndex:"beLateAndLeaveEarly",key:"beLateAndLeaveEarly",align:"center"},{title:I("routes.salary.subsidy"),dataIndex:"subsidy",key:"subsidy",align:"center"},{title:I("routes.salary.socialSecurityAndProvidentFund"),dataIndex:"socialSecurityAndProvidentFund",key:"socialSecurityAndProvidentFund",align:"center"},{title:I("routes.salary.other"),dataIndex:"other",key:"other",align:"center"},{title:I("routes.salary.total"),dataIndex:"total",key:"total",align:"center"},{title:I("routes.salary.action"),key:"action",align:"center",slots:{customRender:"action"}}];var D=m({components:{FormSearch:N,BaseForm:y},setup(){const e=h((()=>p().loading)),y=v(),m=b({pageNum:1,pageSize:10,nickName:"",yearAndMounth:""}),x=b([{type:"input",label:I("routes.salary.nickName"),name:"nickName",value:"",placeholder:I("routes.salary.nickNamePlaceholder")},{type:"month-picker",label:I("routes.salary.yearAndMounth"),name:"yearAndMounth",value:"",placeholder:I("routes.salary.yearAndMounthPlaceholder")}]),S=v([]),L=v({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),M=b({selectedRowKeys:[]}),P=h((()=>M.selectedRowKeys.length>0)),w=e=>{s(e).then((e=>{S.value=e.data.rows,L.value.total=e.data.count,M.selectedRowKeys=[]}))},{open:F,drawerTitle:j}=_(),R=b({yearAndMounth:[{required:!0,message:I("routes.salary.yearAndMounthPlaceholder")}]}),H=b([{name:"yearAndMounth",label:I("routes.salary.yearAndMounth"),type:"month-picker",value:void 0,span:24,labelCol:8,placeholder:I("routes.salary.yearAndMounthPlaceholder")},{name:"expectedAttendanceHours",label:I("routes.salary.expectedAttendanceHours"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.expectedAttendanceHoursPlaceholder")},{name:"attendanceHours",label:I("routes.salary.attendanceHours"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.attendanceHoursPlaceholder")},{name:"paidLeave",label:I("routes.salary.paidLeave"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.paidLeavePlaceholder")},{name:"unpaidLeave",label:I("routes.salary.unpaidLeave"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.unpaidLeavePlaceholder")},{name:"beLateAndLeaveEarly",label:I("routes.salary.beLateAndLeaveEarly"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.beLateAndLeaveEarlyPlaceholder")},{name:"subsidy",label:I("routes.salary.subsidy"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.subsidyPlaceholder"),props:{precision:2}},{name:"socialSecurityAndProvidentFund",label:I("routes.salary.socialSecurityAndProvidentFund"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.socialSecurityAndProvidentFundPlaceholder"),props:{precision:2}},{name:"other",label:I("routes.salary.other"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:I("routes.salary.otherPlaceholder"),props:{precision:2}}]),N=b({id:void 0,yearAndMounth:void 0,expectedAttendanceHours:void 0,attendanceHours:void 0,paidLeave:void 0,unpaidLeave:void 0,beLateAndLeaveEarly:void 0,subsidy:void 0,socialSecurityAndProvidentFund:void 0,other:void 0});return f((async()=>{w(m)})),O=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&r(e,t,a[t]);if(n)for(var t of n(a))o.call(a,t)&&r(e,t,a[t]);return e})({t:I,loading:e,queryParams:m,formFields:x,handleQuery:e=>{L.value.current=1,m.pageNum=L.value.current,m.nickName=e.nickName,m.yearAndMounth=e.yearAndMounth?A(e.yearAndMounth).format("YYYY-MM"):"",w(m)},tableList:S,columns:T,pagination:L,hasSelected:P,getMounth:e=>A(e).format("YYYY-MM"),handleTableChange:e=>{L.value=e,m.pageNum=L.value.current,m.pageSize=L.value.pageSize,w(m)},confirm:e=>{const a=e.id||M.selectedRowKeys;u(a).then((()=>{(a.length&&a.length===S.value.length||1===S.value.length)&&Math.ceil(L.value.total/m.pageSize)===m.pageNum&&m.pageNum>1&&m.pageNum--,w(m),C.success(I("common.deleteSuccess"))}))},cancel:e=>{C.success(I("common.cancelDelete"))},onSelectChange:e=>{M.selectedRowKeys=e},handleAdd:()=>{F.value=!0,j.value=I("common.add")},handleUpdate:e=>{d(e.id).then((e=>{F.value=!0,j.value=I("common.update"),k((()=>{Object.keys(N).forEach((a=>{N[a]=e.data[a]}))}))}))}},g(M)),a(O,t({BaseFormRef:y,open:F,drawerTitle:j,formState:N,rules:R,formDataObj:H,handleClose:()=>{N.id=void 0,y.value.resetFields(),F.value=!1},handleSubmit:()=>{N.id?c(N).then((e=>{C.success(e.message),w(m),N.id=void 0,y.value.resetFields(),F.value=!1})):i(N).then((e=>{C.success(e.message),w(m),N.id=void 0,y.value.resetFields(),F.value=!1}))}}));var O}});const E={class:"p-4"},K={class:"mb-3"};D.render=function(e,a,t,n,l,o){const r=x("form-search"),s=x("a-button"),d=x("a-col"),u=x("a-popconfirm"),c=x("a-row"),i=x("a-table"),p=x("BaseForm"),y=x("a-drawer"),m=S("has-permi");return L(),M("div",E,[P("div",K,[w(r,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),w(c,{gutter:10,class:"mb-2"},{default:F((()=>[w(d,null,{default:F((()=>[w(s,{color:"success",onClick:e.handleAdd},{default:F((()=>[j(R(e.t("common.add")),1)])),_:1},8,["onClick"])])),_:1}),H(w(d,null,{default:F((()=>[w(u,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:F((()=>[w(s,{disabled:!e.hasSelected,color:"error"},{default:F((()=>[j(R(e.t("common.delete")),1)])),_:1},8,["disabled"])])),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])])),_:1},512),[[m,["finance:salary:add"]]])])),_:1}),w(i,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{yearAndMounth:F((({record:a})=>[P("span",null,R(e.getMounth(a.yearAndMounth)),1)])),user:F((({record:e})=>[P("span",null,R(e.user.nickName),1)])),currentSalary:F((({record:e})=>[P("span",null,R(e.user.salary),1)])),action:F((({record:a})=>[P("span",null,[H(w(s,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:F((()=>[j(R(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[m,["finance:salary:update"]]]),w(u,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:F((()=>[H(w(s,{type:"link",color:"error"},{default:F((()=>[j(R(e.t("common.delete")),1)])),_:1},512),[[m,["finance:salary:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),w(y,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:F((()=>[w(p,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{D as default};
