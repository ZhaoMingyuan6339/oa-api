var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{H as r,a as d}from"./index.e0281189.js";import{g as i,s as c}from"./dictFormat.fa6d45c4.js";import{_ as u}from"./index.d425032d.js";import{u as p}from"./useDrawer.60140d94.js";import{_ as m}from"./index.b57edad9.js";import{d as v,c as f,r as g,a as h,f as y,a6 as k,M as b,n as C,l as A,a3 as w,m as x,A as _,B as S,v as R,t as U,a4 as O,V as j,F as I,Z as F,q as T,U as D}from"./ant-design-vue.8fffeee5.js";function E(e){return r("/admin/examineAndApprove/makeUpCard/"+e,"GET",{},!1)}function L(e){return r("/admin/examineAndApprove/makeUpCard/"+e.id,"PUT",e)}const N=[{title:"姓名",key:"user",align:"center",slots:{customRender:"user"}},{title:"待补卡日期",key:"clock_in",align:"center",slots:{customRender:"clock_in"}},{title:"补卡类型",dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:"补卡原因",dataIndex:"makeUpCardReason",key:"makeUpCardReason",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"审批状态",dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:"审批备注",dataIndex:"remark",key:"remark",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var K=v({components:{FormSearch:u,BaseForm:m},setup(){const e=f((()=>d().loading)),u=g([]),m=g([]),v=g(),A=h({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),w=h([{type:"input",label:"姓名",name:"nickName",value:"",placeholder:"请输入姓名"},{type:"select",label:"审批状态",name:"status",value:void 0,placeholder:"请选择审批状态",normalizer:{value:"dictValue",label:"dictLabel"},options:u}]),x=g([]),_=g({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),S=g(),R=h({selectedRowKeys:[]}),U=f((()=>R.selectedRowKeys.length>0)),O=e=>{(function(e={}){return r("/admin/examineAndApprove/makeUpCard","GET",e)})(e).then((e=>{console.log(e),x.value=e.data.rows,_.value.total=e.data.count,R.selectedRowKeys=[]}))},{open:j,drawerTitle:I}=p(),F=h({id:void 0,createdAt:void 0,type:void 0,makeUpCardReason:void 0,userId:void 0,deptId:void 0}),T=h({createdAt:[{required:!0,message:"补卡日期"}],type:[{required:!0,message:"请选择补卡类型"}]}),D=h([{name:"createdAt",label:"补卡日期",type:"date-picker",value:void 0,placeholder:"请选择补卡日期",span:24},{name:"type",label:"补卡类型",type:"select",value:void 0,span:24,placeholder:"请选择补卡类型",options:m,serialize:{value:"dictValue",label:"dictLabel"}},{name:"makeUpCardReason",label:"补卡原因",type:"textarea",value:void 0,span:24,placeholder:"请输入补卡原因"}]);return y((async()=>{u.value=await i("sys_examineAndApprove_status"),m.value=await i("sys_makeUpCard_type"),u.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),m.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),O(A)})),K=((e,a)=>{for(var t in a||(a={}))n.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&s(e,t,a[t]);return e})({loading:e,queryParams:A,formFields:w,handleQuery:e=>{_.value.current=1,A.pageNum=_.value.current,A.nickName=e.nickName,A.type=e.type,A.status=e.status,O(A)},tableList:x,columns:N,pagination:_,hasSelected:U,handleTableChange:e=>{_.value=e,A.pageNum=_.value.current,A.pageSize=_.value.pageSize,O(A)},selectDictLabel:c,confirm:e=>{const a=e.id||R.selectedRowKeys;(function(e){return r("/admin/examineAndApprove/makeUpCard/"+e,"DELETE")})(a).then((()=>{(a.length&&a.length===x.value.length||1===x.value.length)&&Math.ceil(_.value.total/A.pageSize)===A.pageNum&&A.pageNum>1&&A.pageNum--,O(A),b.success("删除成功")}))},cancel:e=>{console.log(e),b.success("取消删除")},onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),R.selectedRowKeys=e}},k(R)),a(K,t({handleExamineAndApprove:async({key:e})=>{console.log(e,S),S.value&&(await E(S.value.id).then((e=>{Object.keys(F).forEach((a=>{F[a]=e.data[a]}))})),F.status=e,L(F).then((e=>{b.success(e.message),O(A)})))},handleClickDropdown:e=>{S.value=e},BaseFormRef:v,open:j,drawerTitle:I,examineAndApproveStatusOptions:u,makeUpCardTypeOptions:m,formState:F,formDataObj:D,rules:T,handleClose:()=>{F.id=void 0,F.userId=void 0,F.deptId=void 0,v.value.resetFields(),j.value=!1},handleAdd:()=>{j.value=!0,F.userId=void 0,F.deptId=void 0,I.value="添加"},handleUpdate:e=>{E(e.id).then((a=>{j.value=!0,I.value="修改",F.userId=e.user.id,F.deptId=e.user.deptId,C((()=>{Object.keys(F).forEach((e=>{F[e]=a.data[e]}))}))}))},handleSubmit:()=>{console.log(F),F.id?L(F).then((e=>{b.success(e.message),O(A),F.id=void 0,v.value.resetFields(),j.value=!1})):function(e={}){return r("/admin/examineAndApprove/makeUpCard","POST",e)}(F).then((e=>{b.success(e.message),O(A),F.id=void 0,v.value.resetFields(),j.value=!1}))}}));var K}});const z={class:"p-4"},P={class:"mb-3"},V=D(" 新增 "),B=D(" 删除 "),q=D("导出"),Q=S("span",{class:"mr-3 text-[#faad14] cursor-pointer"}," 审批 ",-1),G=D(" 修改 "),M=D(" 删除 ");K.render=function(e,a,t,l,n,o){const s=A("form-search"),r=A("a-button"),d=A("a-col"),i=A("a-popconfirm"),c=A("a-row"),u=A("a-menu-item"),p=A("a-menu"),m=A("a-dropdown"),v=A("a-table"),f=A("BaseForm"),g=A("a-drawer"),h=w("has-permi");return x(),_("div",z,[S("div",P,[R(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),R(c,{gutter:10,class:"mb-2"},{default:U((()=>[O(R(d,null,{default:U((()=>[R(r,{color:"success",onClick:e.handleAdd},{default:U((()=>[V])),_:1},8,["onClick"])])),_:1},512),[[h,["examineAndApprove:makeUpCard:add"]]]),O(R(d,null,{default:U((()=>[R(i,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:U((()=>[R(r,{disabled:!e.hasSelected,color:"error"},{default:U((()=>[B])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[h,["examineAndApprove:makeUpCard:delete"]]]),R(d,null,{default:U((()=>[R(r,{color:"normal"},{default:U((()=>[q])),_:1})])),_:1})])),_:1}),R(v,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:U((({record:e})=>[S("span",null,j(e.user.nickName),1)])),clock_in:U((({record:e})=>{var a;return[S("span",null,j(null==(a=e.clock_in)?void 0:a.createdAt),1)]})),type:U((({record:a})=>[S("span",null,j(e.selectDictLabel(e.makeUpCardTypeOptions,a.type)),1)])),status:U((({record:a})=>[S("span",null,j(e.selectDictLabel(e.examineAndApproveStatusOptions,a.status)),1)])),action:U((({record:a})=>[S("span",null,[R(m,{trigger:["click"],onClick:t=>e.handleClickDropdown(a)},{overlay:U((()=>[R(p,{onClick:e.handleExamineAndApprove},{default:U((()=>[(x(!0),_(I,null,F(e.examineAndApproveStatusOptions,(e=>(x(),T(u,{disabled:"0"===e.dictValue,key:e.dictValue},{default:U((()=>[D(j(e.dictLabel),1)])),_:2},1032,["disabled"])))),128))])),_:1},8,["onClick"])])),default:U((()=>[Q])),_:2},1032,["onClick"]),O(R(r,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:U((()=>[G])),_:2},1032,["onClick"]),[[h,["examineAndApprove:makeUpCard:update"]]]),R(i,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:U((()=>[O(R(r,{type:"link",color:"error"},{default:U((()=>[M])),_:1},512),[[h,["examineAndApprove:makeUpCard:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),R(g,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:U((()=>[R(f,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{K as default};
