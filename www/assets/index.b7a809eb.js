var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;"undefined"!=typeof require&&require;import{g as n,u as d,a as c,d as u,b as i}from"./index.73583702.js";import{a as m,f as p,h as f}from"./index.2c6e8c15.js";import{g as h,s as v}from"./dictFormat.b2531267.js";import{u as y}from"./useDrawer.6ddc8ed7.js";import{_ as b}from"./index.440d206b.js";import{u as S}from"./useI18n.94ac6758.js";import{d as g,c as k,r as _,a as C,f as w,a6 as K,M as x,n as N,q as O,a3 as I,t as P,A as R,B as j,k as T,x as U,a4 as F,V as E,U as q,v as D,H as A,F as z,Z as L}from"./ant-design-vue.5cd75ca8.js";const{t:B}=S(),Q=[{title:B("routes.role.roleName"),dataIndex:"roleName",key:"roleName",align:"center"},{title:B("routes.role.roleKey"),dataIndex:"roleKey",key:"roleKey",align:"center"},{title:B("routes.role.roleSort"),dataIndex:"roleSort",key:"roleSort",align:"center"},{title:B("routes.role.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:B("routes.role.createdBy"),dataIndex:"createdBy",key:"createdBy",align:"center"},{title:B("routes.role.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:B("routes.role.action"),key:"action",align:"center",slots:{customRender:"action"}}];var V=g({components:{FormSearch:b},setup(){const e=k((()=>m().loading)),b=_([]),S=_([]),g={roleName:[{required:!0,message:B("routes.role.roleNameIsEmpty"),trigger:"blur"}],roleKey:[{required:!0,message:B("routes.role.roleKeyIsEmpty"),trigger:"blur"}],status:[{required:!0,message:B("routes.role.statusIsEmpty"),trigger:"change"}],menuIds:[{required:!0,validator:()=>[...z.value.checked].length?Promise.resolve():Promise.reject(B("routes.role.menuPermissionIsEmpty")),trigger:"change"}]},O=C({pageNum:1,pageSize:10,roleName:"",status:""}),I=C([{type:"input",label:B("routes.role.roleName"),name:"roleName",value:"",placeholder:B("routes.role.roleNamePlaceholder")},{type:"select",label:B("routes.role.status"),name:"status",value:void 0,placeholder:B("routes.role.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:b}]),P=_([]),R=_({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),j=C({selectedRowKeys:[]}),T=k((()=>j.selectedRowKeys.length>0)),U=e=>{n(e).then((e=>{P.value=e.data.rows,R.value.total=e.data.count,j.selectedRowKeys=[],P.value.forEach((e=>{"1"===e.status?e.checked=!0:e.checked=!1}))}))},F=_(),E=C({id:void 0,roleName:void 0,roleKey:void 0,roleSort:1,status:"1",menuIds:void 0,remark:void 0}),{open:q,drawerTitle:D}=y(),A=_([]),z=_({checked:[]}),L=()=>{p().then((e=>{A.value=f(e.data.rows,"id","parentId").tree}))},V=C([{value:"1",label:B("routes.role.CurrentAndBelow")},{value:"2",label:B("routes.role.current")},{value:"3",label:B("routes.role.myself")}]),M=_(),H=_(!1),Z={dataScope:[{required:!0,message:B("routes.role.menuIdsIsEmpty"),trigger:"blur"}]},$=C({id:void 0,roleName:"",roleKey:"",roleSort:void 0,status:void 0,menuIds:void 0,remark:void 0,dataScope:void 0});return w((async()=>{b.value=await h("sys_normal_disable"),S.value=await h("sys_normal_disable"),S.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),U(O),L()})),G=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&s(e,l,a[l]);return e})({t:B,loading:e,queryParams:O,formFields:I,handleQuery:e=>{R.value.current=1,O.pageNum=R.value.current,O.roleName=e.roleName,O.status=e.status,U(O)},roleList:P,columns:Q,pagination:R,handleTableChange:e=>{R.value=e,O.pageNum=R.value.current,O.pageSize=R.value.pageSize,U(O)},selectDictLabel:v,statusOptions:b},K(j)),a(G,l({hasSelected:T,onSelectChange:e=>{j.selectedRowKeys=e},open:q,drawerTitle:D,formState:E,labelCol:{span:4},wrapperCol:{span:20},rules:g,formRef:F,handleClose:()=>{z.value.checked=[],E.id=void 0,F.value.resetFields(),q.value=!1},handleSubmit:()=>{F.value.validate().then((()=>{E.menuIds=[...z.value.checked],E.id?d(E).then((e=>{x.success(e.message),U(O),E.id=void 0,F.value.resetFields(),q.value=!1})):c(E).then((e=>{x.success(e.message),U(O),E.id=void 0,F.value.resetFields(),q.value=!1}))})).catch((e=>{}))},confirm:e=>{const a=e.id||j.selectedRowKeys;u(a).then((()=>{(a.length&&a.length===P.value.length||1===P.value.length)&&Math.ceil(R.value.total/O.pageSize)===O.pageNum&&O.pageNum>1&&O.pageNum--,U(O),x.success(B("common.deleteSuccess"))}))},cancel:e=>{x.success(B("common.cancelDelete"))},handleAdd:()=>{q.value=!0,D.value=B("common.add")},handleUpdate:e=>{i(e.id).then((e=>{q.value=!0,D.value=B("common.update"),N((()=>{Object.keys(E).forEach((a=>{E[a]=e.data[a]}));const a={checked:e.data.menus.map((e=>e.id)),halfChecked:[]};z.value=K(a)}))}))},menuOptions:A,checkedKeys:z,replaceFields:{children:"children",title:"title",key:"id"},disableOptions:S,dataScopeOptions:V,formScopeRef:M,dataScopeOpen:H,formScopeState:$,scopeRules:Z,handleScopeOpen:e=>{i(e.id).then((e=>{H.value=!0,N((()=>{Object.keys($).forEach((a=>{$[a]=e.data[a]})),$.menuIds=e.data.menus.map((e=>e.id))}))}))},handleScopeClose:()=>{H.value=!1},handleScopeSubmit:()=>{M.value.validate().then((()=>{d($).then((e=>{x.success(e.message),H.value=!1,U(O)}))})).catch((e=>{}))}}));var G}});const M={class:"p-4"},H={class:"mb-3"},Z={class:"text-[#1890ff]"};V.render=function(e,a,l,t,o,r){const s=O("form-search"),n=O("a-button"),d=O("a-col"),c=O("a-popconfirm"),u=O("a-row"),i=O("router-link"),m=O("a-table"),p=O("a-input"),f=O("a-form-item"),h=O("a-input-number"),v=O("a-radio-group"),y=O("a-tree"),b=O("a-textarea"),S=O("a-form"),g=O("a-drawer"),k=O("a-select-option"),_=O("a-select"),C=I("has-permi");return P(),R("div",M,[j("div",H,[T(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),T(u,{gutter:10,class:"mb-2"},{default:U((()=>[F(T(d,null,{default:U((()=>[T(n,{color:"success",onClick:e.handleAdd},{default:U((()=>[E(q(e.t("common.add")),1)])),_:1},8,["onClick"])])),_:1},512),[[C,["system:role:add"]]]),F(T(d,null,{default:U((()=>[T(c,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:U((()=>[T(n,{disabled:!e.hasSelected,color:"error"},{default:U((()=>[E(q(e.t("common.delete")),1)])),_:1},8,["disabled"])])),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])])),_:1},512),[[C,["system:role:delete"]]])])),_:1}),T(m,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.roleList,pagination:e.pagination,onChange:e.handleTableChange},{roleKey:U((({record:e})=>[T(i,{to:"dictData/"+e.id},{default:U((()=>[j("span",Z,q(e.roleKey),1)])),_:2},1032,["to"])])),status:U((({record:a})=>[j("span",null,q(e.selectDictLabel(e.statusOptions,a.status)),1)])),action:U((({record:a})=>[j("span",null,[F(T(n,{type:"link",color:"success",class:"mr-3",onClick:l=>e.handleUpdate(a)},{default:U((()=>[E(q(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[C,["system:role:update"]]]),F(T(n,{type:"link",color:"warning",class:"mr-3",onClick:l=>e.handleScopeOpen(a)},{default:U((()=>[E(q(e.t("routes.role.dataAuth")),1)])),_:2},1032,["onClick"]),[[C,["system:role:update"]]]),T(c,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:l=>e.confirm(a),onCancel:e.cancel},{default:U((()=>[F(T(n,{type:"link",color:"error"},{default:U((()=>[E(q(e.t("common.delete")),1)])),_:1},512),[[C,["system:role:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),T(g,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[6]||(a[6]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:U((()=>[e.open?(P(),D(S,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:U((()=>[T(u,null,{default:U((()=>[T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.roleName"),name:"roleName"},{default:U((()=>[T(p,{value:e.formState.roleName,"onUpdate:value":a[0]||(a[0]=a=>e.formState.roleName=a),placeholder:e.t("routes.role.roleNamePlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.roleKey"),name:"roleKey"},{default:U((()=>[T(p,{value:e.formState.roleKey,"onUpdate:value":a[1]||(a[1]=a=>e.formState.roleKey=a),placeholder:e.t("routes.role.roleKeyPlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.roleSort"),name:"roleSort"},{default:U((()=>[T(h,{class:"!w-[100%]",value:e.formState.roleSort,"onUpdate:value":a[2]||(a[2]=a=>e.formState.roleSort=a),placeholder:e.t("routes.role.roleSortPlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.status"),name:"status"},{default:U((()=>[T(v,{value:e.formState.status,"onUpdate:value":a[3]||(a[3]=a=>e.formState.status=a),options:e.disableOptions},null,8,["value","options"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.menuIds"),name:"menuIds"},{default:U((()=>[T(y,{blockNode:!0,checkable:"",checkStrictly:"","replace-fields":e.replaceFields,"tree-data":e.menuOptions,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[4]||(a[4]=a=>e.checkedKeys=a)},null,8,["replace-fields","tree-data","checkedKeys"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.remark"),name:"remark"},{default:U((()=>[T(b,{rows:3,value:e.formState.remark,"onUpdate:value":a[5]||(a[5]=a=>e.formState.remark=a),placeholder:e.t("routes.role.remarkPlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,null,{default:U((()=>[T(n,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:U((()=>[E(q(e.t("common.okText")),1)])),_:1},8,["onClick"]),T(n,{onClick:e.handleClose},{default:U((()=>[E(q(e.t("common.cancelText")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):A("",!0)])),_:1},8,["title","visible","onClose"]),T(g,{width:"540px",title:e.t("routes.role.assignDataPermissions"),placement:"right",visible:e.dataScopeOpen,"onUpdate:visible":a[10]||(a[10]=a=>e.dataScopeOpen=a),maskClosable:!1,onClose:e.handleScopeClose},{default:U((()=>[e.dataScopeOpen?(P(),D(S,{key:0,ref:"formScopeRef",model:e.formScopeState,rules:e.scopeRules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:U((()=>[T(u,null,{default:U((()=>[T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.roleName"),name:"roleName"},{default:U((()=>[T(p,{disabled:!0,value:e.formScopeState.roleName,"onUpdate:value":a[7]||(a[7]=a=>e.formScopeState.roleName=a),placeholder:e.t("routes.role.roleNamePlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.roleKey"),name:"roleKey"},{default:U((()=>[T(p,{disabled:!0,value:e.formScopeState.roleKey,"onUpdate:value":a[8]||(a[8]=a=>e.formScopeState.roleKey=a),placeholder:e.t("routes.role.roleKeyPlaceholder")},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,{label:e.t("routes.role.dataScope"),name:"dataScope"},{default:U((()=>[T(_,{value:e.formScopeState.dataScope,"onUpdate:value":a[9]||(a[9]=a=>e.formScopeState.dataScope=a),placeholder:e.t("routes.role.dataScopePlaceholder")},{default:U((()=>[(P(!0),R(z,null,L(e.dataScopeOptions,(e=>(P(),D(k,{key:e.value},{default:U((()=>[E(q(e.label),1)])),_:2},1024)))),128))])),_:1},8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),T(d,{span:24},{default:U((()=>[T(f,null,{default:U((()=>[T(n,{type:"primary",class:"mr-3",onClick:e.handleScopeSubmit},{default:U((()=>[E(q(e.t("common.okText")),1)])),_:1},8,["onClick"]),T(n,{onClick:e.handleScopeClose},{default:U((()=>[E(q(e.t("common.cancelText")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):A("",!0)])),_:1},8,["title","visible","onClose"])])};export{V as default};
