var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{H as r,a as c,o as i}from"./index.e0281189.js";import{g as d,s as u}from"./dictFormat.fa6d45c4.js";import{_ as m}from"./index.d425032d.js";import{u as p}from"./useDrawer.60140d94.js";import{d as g,c as h,r as y,a as f,f as b,a6 as v,M as w,l as C,a3 as j,m as k,A as O,B as x,v as _,t as S,a4 as R,V as E,H as K,U as T}from"./ant-design-vue.8fffeee5.js";const A=[{title:"操作人员",dataIndex:"createdBy",key:"createdBy",align:"center"},{title:"接口地址",dataIndex:"url",key:"url",align:"center"},{title:"请求方式",dataIndex:"method",key:"method",align:"center"},{title:"ip地址",dataIndex:"ip",key:"ip",align:"center"},{title:"http状态码",dataIndex:"status",key:"status",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var B=g({components:{FormSearch:m},setup(){const e=c(),m=h((()=>e.loading)),g=y([]),C=f({pageNum:1,pageSize:10,createdBy:"",method:""}),j=f([{type:"input",label:"操作人员",name:"createdBy",value:"",placeholder:"请输入操作人员"},{type:"select",label:"请求方式",name:"method",value:void 0,placeholder:"请选择请求方式",normalizer:{value:"dictValue",label:"dictLabel"},options:g}]),k=y([]),O=y({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),x=f({selectedRowKeys:[]}),_=h((()=>x.selectedRowKeys.length>0)),S=e=>{(function(e={}){return r("/admin/system/logs","GET",e)})(e).then((e=>{console.log(e),k.value=e.data.rows,O.value.total=e.data.count,x.selectedRowKeys=[]}))},{open:R,drawerTitle:E}=p(),K=y(null);return b((async()=>{g.value=await d("sys_method_type"),S(C)})),T=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&s(e,t,a[t]);return e})({loading:m,queryParams:C,formFields:j,handleQuery:e=>{O.value.current=1,C.pageNum=O.value.current,C.createdBy=e.createdBy,C.method=e.method,S(C)},logsList:k,columns:A,pagination:O,hasSelected:_,methodOptions:g,handleExportFile:()=>{i("/admin/system/logs/export",{},"系统日志.xlsx")},clearAll:()=>{r("/admin/system/logs/deleteAllLogs","DELETE").then((()=>{S(C),w.success("清除成功")}))},handleTableChange:e=>{O.value=e,C.pageNum=O.value.current,C.pageSize=O.value.pageSize,S(C)},selectDictLabel:u,confirm:e=>{const a=e.id||x.selectedRowKeys;(function(e){return r("/admin/system/logs/"+e,"DELETE")})(a).then((()=>{(a.length&&a.length===k.value.length||1===k.value.length)&&Math.ceil(O.value.total/C.pageSize)===C.pageNum&&C.pageNum>1&&C.pageNum--,S(C),w.success("删除成功")}))},cancel:e=>{console.log(e),w.success("取消删除")},onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),x.selectedRowKeys=e}},v(x)),a(T,t({open:R,drawerTitle:E,detailObj:K,handleClose:()=>{R.value=!1},showDetail:e=>{R.value=!0,E.value="详细信息",K.value=e,console.log(e)}}));var T}});const F={class:"p-4"},L={class:"mb-3"},z=T("导出"),D=T("清空"),I=T(" 删除 "),N=T(" 详细 "),P=T(" 删除 "),Q={key:0},H={class:"mb-2"},M={class:"mb-2"},U={class:"mb-2"},V={class:"mb-2"},q={class:"mb-2"},G={class:"mb-2"},$={class:"mb-2"};B.render=function(e,a,t,l,o,n){const s=C("form-search"),r=C("a-button"),c=C("a-col"),i=C("a-popconfirm"),d=C("a-row"),u=C("a-table"),m=C("a-drawer"),p=j("has-permi");return k(),O("div",F,[x("div",L,[_(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),_(d,{gutter:10,class:"mb-2"},{default:S((()=>[_(c,null,{default:S((()=>[_(r,{color:"normal",onClick:e.handleExportFile},{default:S((()=>[z])),_:1},8,["onClick"])])),_:1}),R(_(c,null,{default:S((()=>[_(r,{color:"warning",onClick:e.clearAll},{default:S((()=>[D])),_:1},8,["onClick"])])),_:1},512),[[p,["system:logs:deleteAllLogs"]]]),R(_(c,null,{default:S((()=>[_(i,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:S((()=>[_(r,{disabled:!e.hasSelected,color:"error"},{default:S((()=>[I])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[p,["system:logs:delete"]]])])),_:1}),_(u,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.logsList,pagination:e.pagination,onChange:e.handleTableChange},{action:S((({record:a})=>[x("span",null,[_(r,{type:"link",color:"success",class:"mr-3",onClick:t=>e.showDetail(a)},{default:S((()=>[N])),_:2},1032,["onClick"]),_(i,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:S((()=>[R(_(r,{type:"link",color:"error"},{default:S((()=>[P])),_:1},512),[[p,["system:logs:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),_(m,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:S((()=>[e.detailObj?(k(),O("div",Q,[x("p",H,"操作人员: "+E(e.detailObj.createdBy),1),x("p",M,"接口地址: "+E(e.detailObj.url),1),x("p",U,"ip地址: "+E(e.detailObj.ip),1),x("p",V,"请求方式: "+E(e.detailObj.method),1),x("p",q,"http状态码: "+E(e.detailObj.status),1),x("p",G,"请求参数: "+E(e.detailObj.data),1),x("p",$,"创建时间: "+E(e.detailObj.createdAt),1)])):K("",!0)])),_:1},8,["title","visible","onClose"])])};export{B as default};
