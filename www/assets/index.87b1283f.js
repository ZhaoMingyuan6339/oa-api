import{g as e,s as a}from"./dictFormat.b2531267.js";import{g as t}from"./index.a28e8132.js";import{g as l,l as o,u as s,e as i}from"./index.0f56c5f0.js";import{g as n}from"./index.73583702.js";import{u as r,a as d,h as u}from"./index.2c6e8c15.js";import{u as c}from"./useDrawer.6ddc8ed7.js";import{_ as p}from"./index.a5f1b9a4.js";import{_ as m}from"./index.14eac354.js";import{_ as v}from"./index.440d206b.js";import{u as h}from"./useI18n.94ac6758.js";import{d as f,c as y,r as g,a as b,f as k,n as w,M as I,q as S,a3 as D,t as L,A as C,k as N,x as _,B as x,U as F,a4 as j,V as R}from"./ant-design-vue.5cd75ca8.js";const{t:O}=h(),T=[{title:O("routes.holidayDetails.nickName"),dataIndex:"nickName",key:"nickName",align:"center"},{title:O("routes.holidayDetails.department"),key:"department",align:"center",slots:{customRender:"department"}},{title:O("routes.holidayDetails.position"),key:"position",align:"center",slots:{customRender:"position"}},{title:O("routes.holidayDetails.annualLeave"),key:"annualLeave",dataIndex:"annualLeave",align:"center"},{title:O("routes.holidayDetails.compensatoryLeave"),dataIndex:"compensatoryLeave",key:"compensatoryLeave",align:"center"},{title:O("routes.holidayDetails.action"),key:"action",align:"center",slots:{customRender:"action"}}];var z=f({components:{BaseForm:m,DeptSearch:p,FormSearch:v},setup(){const p=r(),m=y((()=>d().loading)),v=g(),h=g([]),f=g([]),S=g([]),D=g([]),L=g([]),C=g([]),N=g(),_=g([]),x=g([]),F=g(),j=b({nickName:"",deptId:0,pageNum:1,pageSize:10}),R=b([{type:"input",label:O("routes.holidayDetails.nickName"),name:"nickName",value:void 0,placeholder:O("routes.holidayDetails.nickNamePlaceholder")}]),z=e=>{U.value.current=1,j.pageNum=U.value.current,j.nickName=e.nickName,q(j)},B=g([]),U=g({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),P=g([]),q=e=>{o(e).then((e=>{B.value=e.data.rows,U.value.total=e.data.count})),t().then((e=>{const a=u(e.data.rows,"deptId","parentId","children",p.userInfo.deptId).tree,t=e.data.rows.filter((e=>e.deptId===p.userInfo.deptId));t[0].children=a,P.value=t}))},E=g(),Q=b([{name:"annualLeave",label:O("routes.holidayDetails.annualLeave"),type:"input-number",value:void 0,span:24,labelCol:8,placeholder:O("routes.holidayDetails.annualLeavePlaceholder")},{name:"compensatoryLeave",label:O("routes.holidayDetails.compensatoryLeave"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:O("routes.holidayDetails.compensatoryLeavePlaceholder")}]),V=b({id:void 0,deptId:void 0,nickName:void 0,userName:void 0,password:void 0,sex:"1",roleIds:[],mobile:void 0,status:"1",email:void 0,salary:void 0,position:"1",entryTime:"",birthday:"",education:void 0,annualLeave:void 0,compensatoryLeave:void 0,remark:void 0}),{open:K,drawerTitle:A}=c(),M=g(!1),$=g(),G=g(!1),H=()=>{t().then((e=>{_.value=e.data.rows,x.value=u(e.data.rows,"deptId","parentId","children",0).tree,N.value.expandedKeys.value=_.value.map((e=>e.id))})),q(j),n().then((e=>{h.value=e.data.rows}))};return k((async()=>{f.value=await e("sys_normal_disable"),S.value=await e("sys_user_position"),D.value=await e("sys_user_education"),L.value=await e("sys_normal_disable"),C.value=await e("sys_user_sex"),L.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),C.value.forEach((e=>{e.label=e.dictLabel,e.value=e.dictValue})),H()})),{t:O,loading:m,replaceFields:{children:"children",title:"deptName",key:"deptId"},deptSearchRef:N,originalTree:_,deptTreeOption:x,handleSelect:e=>{j.deptId=e[0],z(j)},queryRef:F,queryParams:j,formFields:R,handleQuery:z,statusOptions:f,columns:T,userList:B,pagination:U,handleTableChange:e=>{U.value=e,j.pageNum=U.value.current,j.pageSize=U.value.pageSize,q(j)},selectDictLabel:a,getRoles:e=>e.roles.map((e=>e.roleName)).join(","),handleUpdate:e=>{l(e.id).then((e=>{K.value=!0,M.value=!0,A.value=O("common.update"),w((()=>{Object.keys(V).forEach((a=>{V[a]=e.data[a]})),V.roleIds=e.data.roles.map((e=>e.id)),E.value.forest.selectedNodeIds.push(e.data.deptId)}))}))},BaseFormRef:v,formDataObj:Q,treeRef:E,formRef:$,rules:{},isUpdate:M,open:K,drawerTitle:A,deptOptions:P,normalizer:e=>(e.children&&!e.children.length&&delete e.children,{id:e.deptId,label:e.deptName,children:e.children}),handleClose:()=>{V.id=void 0,v.value.resetFields(),K.value=!1},handleSubmit:()=>{V.id?s(V).then((e=>{I.success(e.message),q(j),V.id=void 0,v.value.resetFields(),K.value=!1})):i(V).then((e=>{I.success(e.message),q(j),V.id=void 0,v.value.resetFields(),K.value=!1}))},labelCol:{span:6},wrapperCol:{span:18},formState:V,roleOptions:h,positionOptions:S,educationOptions:D,disableOptions:L,sexOptions:C,visible:G}}});const B={class:"p-4"},U={class:"mb-3"};z.render=function(e,a,t,l,o,s){const i=S("dept-search"),n=S("a-col"),r=S("form-search"),d=S("a-button"),u=S("a-table"),c=S("a-row"),p=S("BaseForm"),m=S("a-drawer"),v=D("has-permi");return L(),C("div",B,[N(c,{gutter:15},{default:_((()=>[N(n,{span:4},{default:_((()=>[N(i,{ref:"deptSearchRef",original:e.originalTree,data:e.deptTreeOption,baseFields:e.replaceFields,onSelect:e.handleSelect},null,8,["original","data","baseFields","onSelect"])])),_:1}),N(n,{span:20},{default:_((()=>[x("div",U,[N(r,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),N(u,{loading:e.loading,rowKey:"id",columns:e.columns,"data-source":e.userList,pagination:e.pagination,onChange:e.handleTableChange},{department:_((({record:e})=>[x("span",null,F(e.department.deptName),1)])),roles:_((({record:a})=>[x("span",null,F(e.getRoles(a)),1)])),position:_((({record:a})=>[x("span",null,F(e.selectDictLabel(e.positionOptions,a.position)),1)])),action:_((({record:a})=>[x("span",null,[j(N(d,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:_((()=>[R(F(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[v,["system:user:update"]]])])])),_:1},8,["loading","columns","data-source","pagination","onChange"])])),_:1})])),_:1}),N(m,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:_((()=>[N(p,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{z as default};
