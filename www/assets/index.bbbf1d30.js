var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{H as s,a as r}from"./index.e0281189.js";import{g as c,s as d}from"./dictFormat.fa6d45c4.js";import{_ as u}from"./index.b57edad9.js";import{_ as m}from"./index.d425032d.js";import{u as p}from"./useDrawer.60140d94.js";import{d as f,c as v,r as b,a as g,f as h,a6 as y,n as k,M as C,l as I,a3 as w,m as F,A as S,B as x,v as T,t as _,a4 as j,V as N,U as O}from"./ant-design-vue.8fffeee5.js";const R=[{title:"姓名",key:"user",align:"center",slots:{customRender:"user"}},{title:"打卡类型",key:"type",align:"center",slots:{customRender:"type"}},{title:"上班打卡WiFi",dataIndex:"wifiBefore",key:"wifiBefore",align:"center"},{title:"上班打卡地址",dataIndex:"firstClockInAddr",key:"firstClockInAddr",align:"center"},{title:"上班打卡时间",dataIndex:"firstClockInTime",key:"firstClockInTime",align:"center"},{title:"下班打卡WiFi",dataIndex:"wifiNext",key:"wifiNext",align:"center"},{title:"下班打卡地址",dataIndex:"lastClockInAddr",key:"lastClockInAddr",align:"center"},{title:"下班打卡时间",dataIndex:"lastClockInTime",key:"lastClockInTime",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var D=f({components:{FormSearch:m,BaseForm:u},setup(){const e=v((()=>r().loading)),u=b([]),m=b(),f=g({pageNum:1,pageSize:10,nickName:"",type:""}),I=g([{type:"input",label:"姓名",name:"nickName",value:"",placeholder:"请输入姓名"},{type:"select",label:"类型",name:"type",value:void 0,placeholder:"请选择类型",normalizer:{value:"dictValue",label:"dictLabel"},options:u}]),w=b([]),F=b({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),S=g({selectedRowKeys:[]}),x=v((()=>S.selectedRowKeys.length>0)),T=e=>{(function(e={}){return s("/admin/baseInfo/clockIn","GET",e)})(e).then((e=>{console.log(e),w.value=e.data.rows,F.value.total=e.data.count,S.selectedRowKeys=[]}))},{open:_,drawerTitle:j}=p(),N=g({type:[{required:!0,message:"请选择类型"}]}),O=g([{name:"type",label:"类型",type:"select",value:void 0,span:24,placeholder:"请选择类型",options:u,serialize:{value:"dictValue",label:"dictLabel"}},{name:"wifiBefore",label:"上班打卡WiFi",type:"input",value:void 0,span:24,placeholder:"请输入打卡WiFi"},{name:"firstClockInAddr",label:"上班打卡地址",type:"input",span:24,value:void 0,placeholder:"请输入上班打卡地址"},{name:"firstClockInTime",label:"上班打卡时间",type:"time-picker",span:24,value:void 0,placeholder:"上班打卡时间",props:{valueFormat:"YYYY-MM-DD HH:mm",format:"HH:mm"}},{name:"wifiNext",label:"下班打卡WiFi",type:"input",value:void 0,span:24,placeholder:"请输入打卡WiFi"},{name:"lastClockInAddr",label:"下班打卡地址",type:"input",span:24,value:void 0,placeholder:"请输入下班打卡地址"},{name:"lastClockInTime",label:"下班打卡时间",type:"time-picker",span:24,value:void 0,placeholder:"下班打卡时间",props:{valueFormat:"YYYY-MM-DD HH:mm",format:"HH:mm"}}]),D=g({id:void 0,type:"1",wifiBefore:void 0,firstClockInAddr:void 0,firstClockInTime:void 0,wifiNext:void 0,lastClockInAddr:void 0,lastClockInTime:void 0});return h((async()=>{u.value=await c("sys_clock_in_type"),u.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),T(f)})),A=((e,a)=>{for(var l in a||(a={}))n.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&i(e,l,a[l]);return e})({loading:e,queryParams:f,formFields:I,handleQuery:e=>{F.value.current=1,f.pageNum=F.value.current,f.nickName=e.nickName,f.type=e.type,T(f)},tableList:w,columns:R,pagination:F,hasSelected:x,handleTableChange:e=>{F.value=e,f.pageNum=F.value.current,f.pageSize=F.value.pageSize,T(f)},selectDictLabel:d,confirm:e=>{const a=e.id||S.selectedRowKeys;(function(e){return s("/admin/baseInfo/clockIn/"+e,"DELETE")})(a).then((()=>{(a.length&&a.length===w.value.length||1===w.value.length)&&Math.ceil(F.value.total/f.pageSize)===f.pageNum&&f.pageNum>1&&f.pageNum--,T(f),C.success("删除成功")}))},cancel:e=>{console.log(e),C.success("取消删除")},onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),S.selectedRowKeys=e},handleAdd:()=>{_.value=!0,j.value="添加打卡"},handleUpdate:e=>{var a;(a=e.id,s("/admin/baseInfo/clockIn/"+a,"GET",{},!1)).then((e=>{_.value=!0,j.value="修改打卡",k((()=>{Object.keys(D).forEach((a=>{D[a]=e.data[a]})),console.log(D)}))}))}},y(S)),a(A,l({BaseFormRef:m,open:_,drawerTitle:j,clockInOptions:u,formState:D,rules:N,formDataObj:O,handleClose:()=>{D.id=void 0,m.value.resetFields(),_.value=!1},handleSubmit:()=>{var e;D.id?(e=D,s("/admin/baseInfo/clockIn/"+e.id,"PUT",e)).then((e=>{C.success(e.message),T(f),D.id=void 0,m.value.resetFields(),_.value=!1})):function(e={}){return s("/admin/baseInfo/clockIn","POST",e)}(D).then((e=>{C.success(e.message),T(f),D.id=void 0,m.value.resetFields(),_.value=!1}))}}));var A}});const A={class:"p-4"},B={class:"mb-3"},H=O(" 新增 "),K=O(" 删除 "),z=O("导出"),E=O(" 修改 "),L=O(" 删除 ");D.render=function(e,a,l,t,n,o){const i=I("form-search"),s=I("a-button"),r=I("a-col"),c=I("a-popconfirm"),d=I("a-row"),u=I("a-table"),m=I("BaseForm"),p=I("a-drawer"),f=w("has-permi");return F(),S("div",A,[x("div",B,[T(i,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),T(d,{gutter:10,class:"mb-2"},{default:_((()=>[j(T(r,null,{default:_((()=>[T(s,{color:"success",onClick:e.handleAdd},{default:_((()=>[H])),_:1},8,["onClick"])])),_:1},512),[[f,["baseInfo:clockIn:add"]]]),j(T(r,null,{default:_((()=>[T(c,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:_((()=>[T(s,{disabled:!e.hasSelected,color:"error"},{default:_((()=>[K])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[f,["baseInfo:clockIn:delete"]]]),T(r,null,{default:_((()=>[T(s,{color:"normal"},{default:_((()=>[z])),_:1})])),_:1})])),_:1}),T(u,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:_((({record:e})=>[x("span",null,N(e.user.nickName),1)])),type:_((({record:a})=>[x("span",null,N(e.selectDictLabel(e.clockInOptions,a.type)),1)])),action:_((({record:a})=>[x("span",null,[j(T(s,{type:"link",color:"success",class:"mr-3",onClick:l=>e.handleUpdate(a)},{default:_((()=>[E])),_:2},1032,["onClick"]),[[f,["baseInfo:clockIn:update"]]]),T(c,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:l=>e.confirm(a),onCancel:e.cancel},{default:_((()=>[j(T(s,{type:"link",color:"error"},{default:_((()=>[L])),_:1},512),[[f,["baseInfo:clockIn:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),T(p,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:_((()=>[T(m,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{D as default};
