var e=Object.defineProperty,a=Object.defineProperties,n=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,n,t)=>n in a?e(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;import{g as s,a as d,d as i,u as c,b as u}from"./index.3ebd564c.js";import{a as p}from"./index.e0281189.js";import{_ as m}from"./index.b57edad9.js";import{d as v,c as y,r as h,a as b,f as g,a6 as f,ac as k,n as C,M as S,l as A,a3 as w,m as x,A as M,B as L,v as F,t as R,a4 as j,V as _,U as O}from"./ant-design-vue.8fffeee5.js";import{_ as N}from"./index.d425032d.js";import{u as I}from"./useDrawer.60140d94.js";const P=[{title:"年月",key:"yearAndMounth",align:"center",slots:{customRender:"yearAndMounth"}},{title:"姓名",key:"user",align:"center",slots:{customRender:"user"}},{title:"目前薪资",key:"currentSalary",align:"center",slots:{customRender:"currentSalary"}},{title:"当月应出勤时长",dataIndex:"expectedAttendanceHours",key:"expectedAttendanceHours",align:"center"},{title:"出勤时长",dataIndex:"attendanceHours",key:"attendanceHours",align:"center"},{title:"带薪假期（小时）",dataIndex:"paidLeave",key:"paidLeave",align:"center"},{title:"无薪假期（小时）",dataIndex:"unpaidLeave",key:"unpaidLeave",align:"center"},{title:"迟到早退（次数）",dataIndex:"beLateAndLeaveEarly",key:"beLateAndLeaveEarly",align:"center"},{title:"补贴",dataIndex:"subsidy",key:"subsidy",align:"center"},{title:"社保/公积金",dataIndex:"socialSecurityAndProvidentFund",key:"socialSecurityAndProvidentFund",align:"center"},{title:"其他",dataIndex:"other",key:"other",align:"center"},{title:"总计（税前工资）",dataIndex:"total",key:"total",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var K=v({components:{FormSearch:N,BaseForm:m},setup(){const e=y((()=>p().loading)),m=h(),v=b({pageNum:1,pageSize:10,nickName:"",yearAndMounth:""}),A=b([{type:"input",label:"姓名",name:"nickName",value:"",placeholder:"请输入姓名"},{type:"month-picker",label:"年月",name:"yearAndMounth",value:"",placeholder:"请选择年月"}]),w=h([]),x=h({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),M=b({selectedRowKeys:[]}),L=y((()=>M.selectedRowKeys.length>0)),F=e=>{s(e).then((e=>{console.log(e),w.value=e.data.rows,x.value.total=e.data.count,M.selectedRowKeys=[]}))},{open:R,drawerTitle:j}=I(),_=b({}),O=b([{name:"yearAndMounth",label:"年月",type:"month-picker",value:void 0,span:24,placeholder:"请选择年月"},{name:"expectedAttendanceHours",label:"应出勤时长",type:"input-number",span:24,value:void 0,placeholder:"请输入应出勤时长"},{name:"attendanceHours",label:"出勤时长",type:"input-number",span:24,value:void 0,placeholder:"请输入出勤时长"},{name:"paidLeave",label:"带薪假期",type:"input-number",span:24,value:void 0,placeholder:"请输入带薪假期"},{name:"unpaidLeave",label:"无薪假期",type:"input-number",span:24,value:void 0,placeholder:"请输入无薪假期"},{name:"beLateAndLeaveEarly",label:"迟到早退",type:"input-number",span:24,value:void 0,placeholder:"请输入迟到早退次数"},{name:"subsidy",label:"补贴",type:"input-number",span:24,value:void 0,placeholder:"请输入补贴",props:{precision:2}},{name:"socialSecurityAndProvidentFund",label:"公积金/社保",type:"input-number",span:24,value:void 0,placeholder:"请输入公积金/社保",props:{precision:2}},{name:"other",label:"其他",type:"input-number",span:24,value:void 0,placeholder:"请输入其他",props:{precision:2}}]),N=b({id:void 0,yearAndMounth:void 0,expectedAttendanceHours:void 0,attendanceHours:void 0,paidLeave:void 0,unpaidLeave:void 0,beLateAndLeaveEarly:void 0,subsidy:void 0,socialSecurityAndProvidentFund:void 0,other:void 0});return g((async()=>{F(v)})),K=((e,a)=>{for(var n in a||(a={}))l.call(a,n)&&r(e,n,a[n]);if(t)for(var n of t(a))o.call(a,n)&&r(e,n,a[n]);return e})({loading:e,queryParams:v,formFields:A,handleQuery:e=>{x.value.current=1,v.pageNum=x.value.current,v.nickName=e.nickName,v.yearAndMounth=e.yearAndMounth?k(e.yearAndMounth).format("YYYY-MM"):"",F(v)},tableList:w,columns:P,pagination:x,hasSelected:L,getMounth:e=>k(e).format("YYYY-MM"),handleTableChange:e=>{x.value=e,v.pageNum=x.value.current,v.pageSize=x.value.pageSize,F(v)},confirm:e=>{const a=e.id||M.selectedRowKeys;i(a).then((()=>{(a.length&&a.length===w.value.length||1===w.value.length)&&Math.ceil(x.value.total/v.pageSize)===v.pageNum&&v.pageNum>1&&v.pageNum--,F(v),S.success("删除成功")}))},cancel:e=>{console.log(e),S.success("取消删除")},onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),M.selectedRowKeys=e},handleAdd:()=>{R.value=!0,j.value="添加打卡"},handleUpdate:e=>{d(e.id).then((e=>{R.value=!0,j.value="修改打卡",C((()=>{Object.keys(N).forEach((a=>{N[a]=e.data[a]})),console.log(N)}))}))}},f(M)),a(K,n({BaseFormRef:m,open:R,drawerTitle:j,formState:N,rules:_,formDataObj:O,handleClose:()=>{N.id=void 0,m.value.resetFields(),R.value=!1},handleSubmit:()=>{N.id?c(N).then((e=>{S.success(e.message),F(v),N.id=void 0,m.value.resetFields(),R.value=!1})):u(N).then((e=>{S.success(e.message),F(v),N.id=void 0,m.value.resetFields(),R.value=!1}))}}));var K}});const H={class:"p-4"},Y={class:"mb-3"},z=O(" 新增 "),D=O(" 删除 "),E=O("导出"),T=O(" 修改 "),B=O(" 删除 ");K.render=function(e,a,n,t,l,o){const r=A("form-search"),s=A("a-button"),d=A("a-col"),i=A("a-popconfirm"),c=A("a-row"),u=A("a-table"),p=A("BaseForm"),m=A("a-drawer"),v=w("has-permi");return x(),M("div",H,[L("div",Y,[F(r,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),F(c,{gutter:10,class:"mb-2"},{default:R((()=>[F(d,null,{default:R((()=>[F(s,{color:"success",onClick:e.handleAdd},{default:R((()=>[z])),_:1},8,["onClick"])])),_:1}),j(F(d,null,{default:R((()=>[F(i,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:R((()=>[F(s,{disabled:!e.hasSelected,color:"error"},{default:R((()=>[D])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[v,["finance:salary:add"]]]),F(d,null,{default:R((()=>[F(s,{color:"normal"},{default:R((()=>[E])),_:1})])),_:1})])),_:1}),F(u,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{yearAndMounth:R((({record:a})=>[L("span",null,_(e.getMounth(a.yearAndMounth)),1)])),user:R((({record:e})=>[L("span",null,_(e.user.nickName),1)])),currentSalary:R((({record:e})=>[L("span",null,_(e.user.salary),1)])),action:R((({record:a})=>[L("span",null,[j(F(s,{type:"link",color:"success",class:"mr-3",onClick:n=>e.handleUpdate(a)},{default:R((()=>[T])),_:2},1032,["onClick"]),[[v,["finance:salary:update"]]]),F(i,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:n=>e.confirm(a),onCancel:e.cancel},{default:R((()=>[j(F(s,{type:"link",color:"error"},{default:R((()=>[B])),_:1},512),[[v,["finance:salary:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),F(m,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:R((()=>[F(p,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{K as default};
