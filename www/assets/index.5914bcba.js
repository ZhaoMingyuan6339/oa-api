var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;"undefined"!=typeof require&&require;import{H as i,a as s}from"./index.2c6e8c15.js";import{g as m,s as d}from"./dictFormat.b2531267.js";import{_ as c}from"./index.440d206b.js";import{_ as u}from"./index.14eac354.js";import{u as p}from"./useDrawer.6ddc8ed7.js";import{u as v}from"./useI18n.94ac6758.js";import{d as k,c as T,r as w,a as f,f as h,a6 as O,M as g,n as b,q as y,a3 as x,t as A,A as C,B as S,k as D,x as R,a4 as _,V as j,U as F,F as N,Z as P,v as E}from"./ant-design-vue.5cd75ca8.js";function I(e){return i("/admin/examineAndApprove/workOverTime/"+e,"GET",{},!1)}function K(e){return i("/admin/examineAndApprove/workOverTime/"+e.id,"PUT",e)}const{t:L}=v(),Y=[{title:L("routes.workOverTime.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:L("routes.workOverTime.workOverTimeDuration"),dataIndex:"workOverTimeDuration",key:"workOverTimeDuration",align:"center",slots:{customRender:"workOverTimeDuration"}},{title:L("routes.workOverTime.workOverTimeReason"),dataIndex:"workOverTimeReason",key:"workOverTimeReason",align:"center"},{title:L("routes.workOverTime.startTime"),dataIndex:"startTime",key:"startTime",align:"center"},{title:L("routes.workOverTime.endTime"),dataIndex:"endTime",key:"endTime",align:"center"},{title:L("routes.workOverTime.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:L("routes.workOverTime.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:L("routes.workOverTime.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:L("routes.workOverTime.action"),key:"action",align:"center",slots:{customRender:"action"}}];var z=k({components:{FormSearch:c,BaseForm:u},setup(){const e=T((()=>s().loading)),c=w([]),u=w(),v=f({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),k=f([{type:"input",label:L("routes.workOverTime.nickName"),name:"nickName",value:"",placeholder:L("routes.workOverTime.nickNamePlaceholder")},{type:"select",label:L("routes.workOverTime.status"),name:"status",value:void 0,placeholder:L("routes.workOverTime.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:c}]),y=w([]),x=w({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),A=w(),C=f({selectedRowKeys:[]}),S=T((()=>C.selectedRowKeys.length>0)),D=e=>{(function(e={}){return i("/admin/examineAndApprove/workOverTime","GET",e)})(e).then((e=>{y.value=e.data.rows,x.value.total=e.data.count,C.selectedRowKeys=[]}))},{open:R,drawerTitle:_}=p(),j=f({id:void 0,type:void 0,workOverTimeReason:void 0,time:[],startTime:"",endTime:""}),F=f({time:[{required:!0,message:L("routes.workOverTime.startTimePlaceholder")}]}),N=e=>{j.startTime=e[0],j.endTime=e[1]},P=f([{name:"time",label:L("routes.workOverTime.selectTime"),type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:[L("routes.workOverTime.startTime"),L("routes.workOverTime.endTime")],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:N,change:N}},{name:"workOverTimeReason",label:L("routes.workOverTime.workOverTimeReason"),type:"textarea",value:void 0,span:24,placeholder:L("routes.workOverTime.workOverTimeReasonPlaceholder")}]);return h((async()=>{c.value=await m("sys_examineAndApprove_status"),c.value.forEach((e=>{e.value=e.dictValue,e.lable=e.dictLabel})),D(v)})),E=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&l(e,t,a[t]);if(o)for(var t of o(a))n.call(a,t)&&l(e,t,a[t]);return e})({t:L,loading:e,queryParams:v,formFields:k,handleQuery:e=>{x.value.current=1,v.pageNum=x.value.current,v.nickName=e.nickName,v.status=e.status,D(v)},tableList:y,columns:Y,pagination:x,hasSelected:S,handleTableChange:e=>{x.value=e,v.pageNum=x.value.current,v.pageSize=x.value.pageSize,D(v)},selectDictLabel:d,confirm:e=>{const a=e.id||C.selectedRowKeys;(function(e){return i("/admin/examineAndApprove/workOverTime/"+e,"DELETE")})(a).then((()=>{(a.length&&a.length===y.value.length||1===y.value.length)&&Math.ceil(x.value.total/v.pageSize)===v.pageNum&&v.pageNum>1&&v.pageNum--,D(v),g.success(L("common.deleteSuccess"))}))},cancel:e=>{g.success(L("common.cancelDelete"))},onSelectChange:e=>{C.selectedRowKeys=e}},O(C)),a(E,t({handleExamineAndApprove:async({key:e})=>{A.value&&(await I(A.value.id).then((e=>{Object.keys(j).forEach((a=>{j[a]=e.data[a]}))})),j.status=e,K(j).then((e=>{g.success(e.message),D(v)})))},handleClickDropdown:e=>{A.value=e},BaseFormRef:u,open:R,drawerTitle:_,examineAndApproveStatusOptions:c,formState:j,formDataObj:P,rules:F,handleClose:()=>{j.id=void 0,u.value.resetFields(),R.value=!1},handleAdd:()=>{R.value=!0,_.value=L("common.add")},onOkTime:N,handleUpdate:e=>{I(e.id).then((e=>{R.value=!0,_.value=L("common.update"),b((()=>{Object.keys(j).forEach((a=>{j[a]=e.data[a],j.time=["",""],"startTime"===a&&b((()=>{j.time[0]=e.data[a]})),"endTime"===a&&b((()=>{j.time[1]=e.data[a]}))}))}))}))},handleSubmit:()=>{j.id?K(j).then((e=>{g.success(e.message),D(v),j.id=void 0,u.value.resetFields(),R.value=!1})):function(e={}){return i("/admin/examineAndApprove/workOverTime","POST",e)}(j).then((e=>{g.success(e.message),D(v),j.id=void 0,u.value.resetFields(),R.value=!1}))}}));var E}});const M={class:"p-4"},q={class:"mb-3"},B={class:"mr-3 text-[#faad14] cursor-pointer"};z.render=function(e,a,t,o,r,n){const l=y("form-search"),i=y("a-button"),s=y("a-col"),m=y("a-popconfirm"),d=y("a-row"),c=y("a-menu-item"),u=y("a-menu"),p=y("a-dropdown"),v=y("a-table"),k=y("BaseForm"),T=y("a-drawer"),w=x("has-permi");return A(),C("div",M,[S("div",q,[D(l,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),D(d,{gutter:10,class:"mb-2"},{default:R((()=>[_(D(s,null,{default:R((()=>[D(i,{color:"success",onClick:e.handleAdd},{default:R((()=>[j(F(e.t("common.add")),1)])),_:1},8,["onClick"])])),_:1},512),[[w,["examineAndApprove:workOverTime:add"]]]),_(D(s,null,{default:R((()=>[D(m,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:R((()=>[D(i,{disabled:!e.hasSelected,color:"error"},{default:R((()=>[j(F(e.t("common.delete")),1)])),_:1},8,["disabled"])])),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])])),_:1},512),[[w,["examineAndApprove:workOverTime:delete"]]])])),_:1}),D(v,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:R((({record:e})=>[S("span",null,F(e.user.nickName),1)])),status:R((({record:a})=>[S("span",null,F(e.selectDictLabel(e.examineAndApproveStatusOptions,a.status)),1)])),action:R((({record:a})=>[S("span",null,[_(S("span",null,[D(p,{trigger:["click"],onClick:t=>e.handleClickDropdown(a)},{overlay:R((()=>[D(u,{onClick:e.handleExamineAndApprove},{default:R((()=>[(A(!0),C(N,null,P(e.examineAndApproveStatusOptions,(e=>(A(),E(c,{disabled:"0"===e.dictValue,key:e.dictValue},{default:R((()=>[j(F(e.dictLabel),1)])),_:2},1032,["disabled"])))),128))])),_:1},8,["onClick"])])),default:R((()=>[S("span",B,F(e.t("routes.workOverTime.approve")),1)])),_:2},1032,["onClick"])],512),[[w,["examineAndApprove:workOverTime:update"]]]),_(D(i,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:R((()=>[j(F(e.t("common.update")),1)])),_:2},1032,["onClick"]),[[w,["examineAndApprove:workOverTime:update"]]]),D(m,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:R((()=>[_(D(i,{type:"link",color:"error"},{default:R((()=>[j(F(e.t("common.delete")),1)])),_:1},512),[[w,["examineAndApprove:workOverTime:delete"]]])])),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),D(T,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[0]||(a[0]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:R((()=>[D(k,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])])),_:1},8,["title","visible","onClose"])])};export{z as default};
